---
title: ""
output:
  pdf_document:
    number_sections: true
    includes:
      in_header: D:\MATHEUS\Estatística\5º semestre\Análise de Regressão Linear\Trabalho\Trabalho\head.tex
bibliography: bib.bib
link-citations: true
nocite: | 
  @ref1, @ref2, @ref3, @ref4, @ref5, @ref6
---

\centering
\raggedright
\begin{center}
```{r pressure, echo=FALSE,out.width = '50%',fig.align='center'}
knitr::include_graphics("unb.jpg")
```
 \Large Universidade de Brasília\\
 IE - Departamento de Estatística\\
 Análise de Regressão Linear
\end{center} 
 \vskip 12em
\begin{center}
 \Large \textbf{Trabalho Final - Análise de Dados}
 \par
 \vskip 7em
\end{center}
\setlength{\baselineskip}{.5cm}
\small \textbf{}
\par
\vskip 5em

\begin{flushright}
\small Bruno Henrique Brandão de Souza - 180074695\\
\small Matheus Erbisti Pontes - 180024990\\
\small Ramon Moreira Gonçalves - 180036980\\
\vskip 2em
\small Prof.ª Maria Teresa Costa Leão
\end{flushright}

\vskip 6em
\begin{center}
\setlength{\baselineskip}{.5cm}
Brasília\\
\vskip 1em
Dezembro de 2020
\end{center}
\newpage
\renewcommand{\contentsname}{Sumário}
\tableofcontents
\newpage

\justify

\fontsize{10pt}{13pt}\selectfont

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(pacman)
pacman:::p_load("tidyverse", "gridExtra", "knitr","openxlsx","readr","lmtest","leaps","car")

setwd("D:/MATHEUS/Estatística/5º semestre/Análise de Regressão Linear/Trabalho/Dados")
dados <-  readxl::read_xlsx("Dados.xlsx")#Importar o Banco de dados

amostra1 <- readr::read_rds("amostra1.xls")
amostra2 <- readr::read_rds("amostra2.xls")


dados$X7 <- as.factor(dados$X7)
dados$X8 <- as.factor(dados$X8)
amostra1$X7 <- as.factor(amostra1$X7)
amostra1$X8 <- as.factor(amostra1$X8)
amostra2$X7 <- as.factor(amostra2$X7)
amostra2$X8 <- as.factor(amostra2$X8)

dados1 <- dados %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))

amostra1 <- amostra1 %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))

amostra2 <- amostra2 %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))


# Banco modelo 1 - Amostra 1
banco.modelo1 <- amostra1 %>% 
  select(X10,X11,X8)


names(banco.modelo1) <- c("Y","X1","X2")
banco.modelo1$X2 <- as.character(banco.modelo1$X2)

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.modelo1$X21 <- as.numeric(a)    

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.modelo1$X22 <- as.numeric(a)    

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.modelo1$X23 <- as.numeric(a) 

banco.modelo1 <- banco.modelo1[,-3]

# Banco modelo 1 - Amostra de Validação
banco.validacao1 <- amostra2 %>% 
  select(X10,X11,X8)


names(banco.validacao1) <- c("Y","X1","X2")
banco.validacao1$X2 <- as.character(banco.validacao1$X2)

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.validacao1$X21 <- as.numeric(a)    

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.validacao1$X22 <- as.numeric(a)    

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.validacao1$X23 <- as.numeric(a) 

banco.validacao1 <- banco.validacao1[,-3]

# Banco modelo 2
banco.modelo2 <- amostra1 %>% 
  select(X1,X2,X3,X6,X9,X10,X7,X8)

names(banco.modelo2) <- c("Y","X1","X2","X3","X4","X5","X6","X7")
banco.modelo2$X7 <- as.character(banco.modelo2$X7)

a <- banco.modelo2$X6
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.modelo2$X61 <- as.factor(a) 


a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.modelo2$X71 <- as.factor(a)    

a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.modelo2$X72 <- as.factor(a)    

a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.modelo2$X73 <- as.factor(a) 

banco.modelo2 <- banco.modelo2[,c(-7,-8)]


# Banco modelo 2 - Validação
banco.validacao2 <- amostra2 %>% 
  select(X1,X2,X3,X6,X9,X10,X7,X8)

names(banco.validacao2) <- c("Y","X1","X2","X3","X4","X5","X6","X7")
banco.validacao2$X7 <- as.character(banco.validacao2$X7)

a <- banco.validacao2$X6
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.validacao2$X61 <- as.factor(a) 


a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.validacao2$X71 <- as.factor(a)    

a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.validacao2$X72 <- as.factor(a)    

a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.validacao2$X73 <- as.factor(a) 

banco.validacao2 <- banco.validacao2[,c(-7,-8)]

```

# Introdução e Objetivos

O banco de dados recebido inicialmente nesse trabalho provém de uma amostra de 113 hospitais, selecionados aleatoriamente	dentre 338 pesquisados nos Estados	Unidos no período	de 1975-1976. Sendo assim, foram retiradas duas novas amostras repartindo ao meio aleatoriamente o banco de dados inicial de tamanhos 57 e 56 observações; A primeira será utilizada para a formação do modelo e a segunda será utilizada para a validação.

Nossos objetivos serão analisar e investigar fatores que podem ou não influenciar na duração da internação em hospitais. Mais especificamente, queremos estudar: 

* **Questão 1)** Se o número de enfermeira(o)s do hospital está associado com os serviços disponíveis e também com às instalações através de um modelo de segunda ordem, além da região onde se encontra; 

* **Questão 2)** Se a duração da internação está relacionado com as características do paciente, seu respectivo tratamento, além do hospital.

Com este intuito, nosso banco contém as seguintes variáveis e informações relacionadas:

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
codigo <- c("ID","X1","X2","X3","X4","X5","X6","X7","X8","X9","X10","X11")
nome <- c("Número de Identificação","Duração da Internação","Idade","Risco de Infecção","Proporção de Culturas de Rotina","Proporção de Raio-X de Tórax de Rotina","Número de leitos","Filiação a Escola de Medicina","Região","Média diária de pacientes","Número de enfermeiro(s) ","Facilidades e serviços disponíveis")

descricao <- c("1-113","Duração média da internação de todos os pacientes no hospital (em dias)","Idade média dos pacientes","Probabilidade média estimada de adquirir infecção no hospital (em %)","Razão do número de culturas realizadas com relação ao número de pacientes sem sinais ou sintomas de infeção adquirida no hospital, vezes 100.","Razão do número de Raio-X de Tórax realizados com relação ao número de pacientes sem sinais ou sintomas de pneumonia, vezes 100.","Número médio de leitos no hospital durante o período de estudo","1 – sim 2 – não","Região Geográfica, onde: 1 – NE 2- NC 3 – S e 4 – W","Número médio de pacientes no hospital por dia durante o período do estudo","Número médio de enfermeiros(as) de tempo-integral ou equivalente registrados e licenciados durante o período de estudo ( número de tempos integrais+metade do número de tempo parcial)","% de 35 potenciais facilidades e serviços que são fornecidos pelo hospital")

table <- data.frame(codigo,nome,descricao)
kable(table, col.names = c("Código       ","   Nome   ","Descrição"))
```

\newpage

O estudo em questão será realizado através de medidas descritivas, análise exploratória e de resíduos, testes de hipóteses adequados, modelos e técnicas de regressão. 

* Com os dados completos serão feitas as análises descritivas e exploratórias; 
* A amostra 1 (tamanho 57) será utilizada para a modelagem dos modelos propostos;
* A amostra 2 (tamanho 56) servirá para a validação dos modelos encontrados.

\newpage

# Metodologia


## Desenvolvimento Inicial do Estudo

### Seleção da amostra

Primeiramente, tivemos que selecionar duas amostras aleatórias sem reposição de tamanho 57 e 56, totalizando o número de observações do banco fornecido; ou seja, dividimos de maneira aleatória o banco completo em dois.

### Formulação do Modelo 1 

Referente a questão 1 citada na seção de "Introdução e Objetivos", formulamos o seguinte modelo:

$$Y_i=\beta_0+\beta_1 x_{i1}+\beta_{11}x^2_{i1}+\beta_{21} X_{i21}+\beta_{22} X_{i22}+\beta_{23} X_{i23}$$

onde:
 
$$x_{i1} = X_{i1} - \bar{X}$$


$$X_{i21} = \left\{\begin{matrix}
1\text{, se NE}\\ 0\text{, caso contrário}
\end{matrix}\right.$$
 
$$X_{i22} = \left\{\begin{matrix}
1\text{, se NC}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$
 

$$X_{i23} = \left\{\begin{matrix}
1\text{, se S}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$


* $Y_i$ representa a quantidade de enfermeiro(s) do hospital(i);
* $X_{i1}$ representa a Facilidades e serviços disponíveis em porcentagem do hospital(i)(Variável $X11$ no banco);

A variável Região ($X8$) por ser uma variável qualitativa foi dividida em três variáveis indicadoras distintas. Utilizando a região *W* como referência, temos que:

* $X_{i21}$ indica que o hospital(i) se encontra na região *NE*;
* $X_{i22}$ indica que o hospital(i) se encontra na região *NC*;
* $X_{i23}$ indica que o hospital(i) se encontra na região *S*.

\newpage

### Formulação do Modelo 2

Referente a questão 2 citada na seção de "Introdução e Objetivos", formulamos o seguinte modelo:

$$Y_i = \beta_0 + \beta_1 X_{i1}  + \beta_2 X_{i2} +\beta_3 X_{i3}+\beta_4 X_{i4}+\beta_5 X_{i5}+\beta_{61} X_{i61}+\beta_{71} X_{i71}+\beta_{72} X_{i72} + \beta_{73} X_{i73}+  \epsilon_i$$


$$X_{i61} = \left\{\begin{matrix}
1\text{, se é filiado a escola de medicina}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$
 
$$X_{i71} = \left\{\begin{matrix}
1\text{, se NE}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$
 

$$X_{i72} = \left\{\begin{matrix}
1\text{, se NC}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$
 
$$X_{i73} = \left\{\begin{matrix}
1\text{, se S}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$


* $Y_i$ representa a duração média da internação do paciente no hospital(i) (em dias);
* $X_{i1}$ indica a idade média dos pacientes no hospital(i)(Variável $X2$ no banco); 
* $X_{i2}$ é a probabilidade média do risco de infecção no hospital(i)(em porcentagem) (Variável $X3$ no banco);
* $X_{i3}$ indica o número médio de leitos do hospital(i)(Variável $X6$ no banco);
* $X_{i4}$ representa a média diária de pacientes do hospital(i)(Variável $X9$ no banco);
*  $X_{i5}$ representa o número médio de enfermeiros(as) do hospital(i)(Variável $X10$ no banco);

A variável Filiação a Escola de Medicina ($X7$) por ser uma variável qualitativa foi dividida em uma indicadora.

* Para a variável $X_{i61}$, caso o hospital(i) seja filiado a escola de medicina, será colocado *1*, caso não for, será atribuido o valor 0;

A variável Região ($X8$) por ser uma variável qualitativa foi dividida em três variáveis indicadoras distintas. Utilizando a região *W* como referência, temos que:

* $X_{i71}$ indica que o hospital(i) se encontra na região *NE*;
* $X_{i72}$ indica que o hospital(i) se encontra na região *NC*;
* $X_{i73}$ indica que o hospital(i) se encontra na região *S*.

As seguintes variáveis foram escolhidas para o modelo devido ao respectivo critério:

* "Idade" é a variável relacionada as características do paciente;
* "Risco de Infecção" é a variável relacionada as características do tratamento do paciente;
* "Número de leitos", "Média diária de pacientes", "Número de enfermeiro(s)", "Filiação a Escola de Medicina", "Região" são variáveis relacionadas as características do hospital.

\newpage

## Técnicas e Informações Importantes

Nessa seção, iremos comentar e demonstrar as mais importantes e não tão intuitivas relações, técnicas e fórmulas utilizadas para a obtenção dos resultados; vale ressaltar também que o pesquisador deseja correr um risco de no máximo 5%, logo, o nível de significância utilizado em todo esse seminário é de $\alpha = 0.05$.

Além disso, devemos mencionar que para a realização deste trabalho foi utilizado a linguagem R versões 4.0.2/4.0.3/3.6.1 e o software RStudio versões 1.2.1335/1.3.1073.

### Medidas Descritivas

**Coeficiente de Variação**

O coeficiente de variação é calculado da seguinte forma:

$$C_{VAR}=\frac{S}{\overline{X}} . 100$$

Onde:

* $C_{VAR}$ é o coeficiente de variação;
* $S$ é o desvio padrão da amostra;
* $\bar{X}$ é a média amostral.

O coeficiente de variação possui o intuito de informar sobre a dispersão dos dados em relação à sua própria média. Podemos interpretar esse coeficiente como sendo diretamente proporcional a variação dos dados; isso é, quanto maior o valor calculado do coeficiente, maior a variância dos dados, e vice-versa.

Por fim, vale ressaltar que pelo coeficiente de variação ser calculado em valor relativo, ele torna possível a comparação de valores e variáveis que possuem diferentes unidades de medida.

\newpage

**Coeficiente de Correlação de Pearson**

O coeficiente de correlação de Pearson é uma medida cujo intuito é a verificação do grau de relação linear entre duas variáveis quantitativas, da seguinte forma:

$$r = \frac{\sum_{i=1}^{n} [(x_i - \bar{x}) (y_i - \bar{y})]}{\sqrt{\sum_{i=1}^{n} x_i^2 - n\bar{x}^2} . \sqrt{\sum_{i=1}^{n} y_i^2 - n\bar{y}^2}}$$

Em que: 

* $x_i$ é a i-ésima observação da variável $X$;
* $y_i$ é a i-ésima observação da variável $Y$;
* $\bar{x}$ é a média simples dos valores da variável $X$;
* $\bar{y}$ é a média simples dos valores da variável $Y$.

Temos duas propriedades importantes do coeficiente de Pearson:

* É uma medida paramétrica, o que significa que pode ser perturbada pela falta de normalidade dos dados.;
* Esse coeficiente varia de $[-1;1]$.

Dessa forma, podemos interpretar o valor obtido da seguinte forma:

* -1 significa uma correlação linear perfeita e negativa.
* 0 demonstra uma falta de correlação entre as duas variáveis.
* 1 indica uma correlação linear perfeita e positiva.

**Coeficiente de Correlação de Spearman**

Similarmente ao coeficiente de correlação de Pearson, o coeficiente de correlação de Spearman serve para verificar o grau de relação linear entre duas variáveis. Contudo, o último é uma medida não-paramétrica, utilizando os postos das observações das duas variáveis. Portanto, temos sua respectiva fórmula:

$$\rho = \frac{ \sum_{i=1}^{n} \Big[ \big( R(x_i) - \frac{n+1}{2} \big) \big( R(y_i)-\frac{n+1}{2} \big) \Big]}
{\sqrt{\sum_{i=1}^{n}  R^2(x_i) - n (\frac{n+1}{2})^{2}} . \sqrt{\sum_{i=1}^{n}  R^2(y_i) - n (\frac{n+1}{2})^{2}}}$$

No qual:

* $R(x_i)$ é o ranque do posto da i-ésima observação de $X$;
* $R(y_i)$ é o ranque do posto da i-ésima observação de $Y$;
* $n$ é o tamanho amostral.



Analogamente ao $r$ de Pearson, o $\rho$ de Spearman varia de $[-1;1]$, o que também significa que:

* -1 significa uma correlação linear perfeita e negativa.
* 0 demonstra uma falta de correlação entre as duas variáveis.
* 1 indica uma correlação linear perfeita e positiva.

Entretanto, o $\rho$ de Spearman não é uma medida paramétrica, ou seja, ela não é afetada pela falta de normalidade dos dados, sendo ideal nesses cenários.

### Regressão Linear Múltiplo

O modelo de regressão linear múltiplo de ordem 1 com p variáveis explicativas tem a forma:

$$Y_i = \beta_0 + \beta_1 X_{i1} + \dots + \beta_p X_{ip}  + \varepsilon_i$$

* $Y_i$ é o valor da variável resposta para a i-ésima observação da amostra;
* $\beta_0, \beta_1, \dots, \beta_p$ são os parâmetros desconhecidos;
* $X_{i1}, X_{i2}, \dots, X_{ip}$ são constantes conhecidas;
* $\varepsilon_i$ é o erro da i-ésima observação, sendo independentes e $\sim N(0, \sigma^2)$.

Sendo assim, a função resposta para o modelo é:

$$E(Y|X) = \beta_0 + \beta_1 X_1 +\dots+\beta_p X_p$$

E, como $\beta_0, \beta_1, \dots, \beta_p$ são desconhecidos, podemos estimá-los através de mínimos quadrados ordinários, onde as estimativas de Beta são:
 
$$\boldsymbol{\hat{\beta}} = \mathbf{(X'X)^{-1} X'Y}$$
 
Em que:
 \begin{align}
     &Y = 
     \begin{pmatrix}
     y_1\\
     y_2\\
     \vdots \\
     y_n
     \end{pmatrix}
     \qquad
     X = 
     \begin{pmatrix}
     1 &x_{11} &\dots &x_{1p}\\
     1 &x_{21} &\dots &x_{2p}\\
     \vdots &\vdots &\vdots &\vdots\\
     1 &x_{n1} &\dots &x_{np}
     \end{pmatrix}
     \label{Y,X matricial}\\
     &\hat \beta = 
     \begin{pmatrix}
     \hat \beta_0\\
     \hat \beta_1\\
     \vdots \\
     \hat \beta_{p}
     \end{pmatrix}
 \end{align}
 
**Valor predito e Intervalo de Predição**

O valor predito é o valor que o modelo prediz para a variável resposta, considerando os respectivos valores das variáveis explicativas, sendo definido como:
 
$$\mathbf{Y} = \mathbf{X} \hat{\boldsymbol{\beta}}$$

Denotando como $\hat{Y}_n$ o valor predito de uma nova variável, $\hat{Y}_n$ seguirá uma distribuição Normal com média $E(Y_n)$ e variância $\sigma^2 \bigg[1 + \frac{1}{n} + \frac{(X_0 - \overline{X})}{\sum_{i=1}^{n} (X_i - \overline{X})^2} \bigg]$.
 
Com isso, um intervalo de predição $(1 - \alpha)$ para $E(Y_n)$ tem a seguinte estrutura:
 
$$IC(E(Y_n); 1 - \alpha) = \bigg(\hat{Y}_n - t_{(1 - \frac{\alpha}{2}; n - (p+1))}\sqrt{QMRes A} ; \hat{Y}_n + t_{(1 - \frac{\alpha}{2}; n - (p+1))}\sqrt{QMRes A} \bigg)$$

No qual $A = \bigg[1 + \frac{1}{n} + \frac{(X_0 - \overline{X})}{\sum_{i=1}^{n} (X_i - \overline{X})^2} \bigg]$.
 
\newpage

**Resíduo**

O resíduo é a estimativa do erro do modelo, que é calculado pela diferença entre o valor observado e o predito, ou seja:

$$e_i = Y_i - \hat Y_i$$
**Soma de Quadrados**

É importante definir as somas de quadrados para resíduos, totais e regressão, assim como seus respectivos quadrados médios; pois ambos são necessários para outros cálculos que faremos mais adiante. Portanto:

* Soma de quadrados de resíduo

$$SQ_{\text{RES}} = \sum_{i=1}^{n}e_i^{2}$$
$$QM_{\text{RES}} = \frac{SQ_{\text{RES}}}{G.L.(\text{resíduos})}$$
 
* Soma de quadrados de regressão

$$SQ_{\text{REG}} = \sum_{i=1}^{n}(\hat{Y_i}-\bar{Y})^{2}$$
$$QM_{\text{REG}} = \frac{SQ_{\text{REG}}}{G.L(\text{regressão})}$$
 
* Soma de quadrados totais

$$SQ_{\text{TOTAL}} = \sum_{i=1}^{n}(Y_i-\bar{Y})^{2}$$
$$QM_{\text{TOTAL}} = \frac{SQ_{\text{TOTAL}}}{G.L(\text{total})}$$

 
**Coeficiente de Determinação na Regressão**

O coeficiente de determinação $R^2$ verifica o grau de explicação dos valores da variável $Y$ em relação às variáveis independentes $(X_1, \, X_2, \, \ldots, \, X_p)$.
Dessa maneira, temos a seguinte fórmula de cálcula dessa medida:

$$R^2 = \frac{ \sum^n_{i=1} (\hat{Y_i} - \overline{Y})^2}{\sum^n_{i=1} (Y_i - \overline{Y})^2} = \frac{SQ_{\text{REG}}}{SQT}$$

em que:

* $n$ é o tamanho da amostra;
* $\bar{y}$ é a média simples da variável resposta $Y$;
* $\hat{y_i}$ é o i-ésimo valor predito pela regressão;

\newpage

Podemos notar aqui duas propriedades importantes do coeficiente $R^2$:

* Seu valor calculado sempre se encontrará no intervalo $[0;1]$. Então, podemos interpretá-lo como uma porcentagem do grau de explicação; ou seja, valores próximos de 0 indicam uma baixa taxa de explicação, enquanto que valores próximos de 1 representam uma alta porcentagem de explicação.

* A inclusão de mais variáveis explicativas no modelo resulta um incremento no valor de $SQ_{\text{REG}}$, independente da relevância dessas variáveis explicativas. Dessa forma, foi criado uma "correção" para o $R^2$, denominada $R^2_{\text{ajustado}}$: 

$$R^2_{\text{ajustado}} = 1 - \frac{(n-1)(1-R^2)}{n-(p+1)}$$

onde:

* $p$ é o número de variáveis explicativas do modelo.

Então, com essa correção, o $R^2_{\text{ajustado}}$ não terá seu valor inflacionado caso a(s) variável(eis) introduzidas não sejam significativas. Além disso, isso também possibilita a comparação de modelos com diferentes quantidades de variáveis explicativas.

**Critério de Informação Bayesiano (BIC)**


O Critério de Informação Bayesiano (BIC) é definido como:

$$BIC_p = -2log(L_p)+[(p+1)+1]log(n)$$
  
Tendo que $L_p$ é a função de máxima verossimilhança do modelo e $p$ o número de variáveis explicativas do modelo em questão.
  
Quanto maior o SQE, maior será o BIC. Logo, quanto o menor BIC, melhor.
  
**Critério de Mallows ($Cp$)**
  
  $$C_p=\frac{SSE_p}{MSE}-(n-2p)$$
onde MSE é o quadrado médio do erro para o modelo
    
Caso o modelo for adequado utilizando 1-p, vamos ter 
    $$MSE_p = \frac{SSE_p}{n-p}$$
Sendo $p$ o número de variáveis explicativas do modelo em questão.
    
Com isso, temos que $MSE_p$ é um estimador de $\sigma^2$. Assim podendo provar que a esperança de $C_p$ é o número de variáveis explicativas.

\newpage

### Testes de hipóteses sobre o modelo

**Teste t para os coeficientes**

Podemos verificar a significância individual dos coeficientes e, para tal, utiliza-se seguintes as hipóteses:

$$H_{0}: \beta_i = 0$$
$$H_{1}: \beta_i \neq 0$$

Além disso, sabemos que $\widehat{Var(\hat{\beta})} = QMRes C_{jj}$.

Onde:

* $C_{jj}$ é o j-ésimo elemento da diagonal da matriz $(\mathbf{X'X})^{-1}$;
* $QM_{\text{RES}}$ é o quadrado médio do resíduo.

Como $\hat{\beta_j}$ é uma combinação linear de distribuições normais, então $\hat{\beta_j}$ segue uma distribuição Normal. Portanto, sob $H_0$, a estatística do teste é:

$$t_0 = \frac{\hat{\beta_j}}{\sqrt{QMRes C_{jj}}} \sim t_{(n - p - 1)}$$

com nível de significância $\alpha$, a hipótese $H_0$ é rejeitada se $|t_0|> t_{(1 - \frac{\alpha}{2}, n - p - 1)}$. Pelo p-valor, temos a seguinte expressão:

$$\text{p-valor} = 2P(t_{n - p - 1}>|t_0|)$$

Rejeita-se $H_0$ se o p-valor $< \alpha$.
 
**Teste F - ANOVA**

No teste ANOVA, temos as seguintes hipóteses:

$$H_{0}: \beta_1 = \beta_2 = ... = \beta_p = 0$$
$$H_{1}: \text{Existe pelo menos um } \beta_k \neq 0, k = 0,1,2,...p$$

Sendo assim, a hipotése nula pode ser entendida como ausência de regressão, enquanto que a hipótese alternativa como existência de regressão. Abaixo, temos a tabela ANOVA:

```{r echo=FALSE}
kable(cbind(
  c("Regressão", "Resíduo", "Total"),
  c("SQReg", "SQRes", "SQTotal"),
  c("p", "n - (p+1)", "n - 1"),
  c("QMReg", "QMRes", ""),
  c("QMReg/QMRes", "", "")
), col.names = c("Fonte de Variação", "SQ", "G.L.", "QM", "F"))
```


Então, sob $H_0$, a estatística do teste é:

$$F_{0} = \frac{QMReg}{QMRes}$$

com distribuição $F_{p;(n-(p+1))}$.

\newpage

Considerando o p-valor, por meio da expressão:

$$P(F_{p, n-(p+1)} > |F_{0}|)$$
 
Rejeita-se $H_{0}$, caso p-valor seja menor que o nível de significância $\alpha$.

**Teste de Correlação de Pearson**

Tem-se as seguintes hipóteses para o teste de correlação de Pearson:

$$H_{0}: \text{Não há correlação linear entre as variáveis X e Y, i.e, } r = 0$$
$$H_{1}: \text{Há correlação linear entre as variáveis X e Y, i.e, } r \neq 0$$

em que $r$ é o parâmetro a ser testado.

Assumindo que as variáveis $X$ e $Y$ tem distribuição aproximadamente Normal, a estatística do teste é dada por:

$$t_{0} = \frac{r \sqrt{n-2}}{\sqrt{1-r^2}} \sim t_{n-2} $$

Portanto sob $H_{0}$, $t_{0}$ segue uma distribuição $t_{n-2}$.

**Teste de Correlação de Spearman**

Para o teste de correlação de Spearman, temos as seguintes hipóteses:

$$H_{0}: \text{Não há correlação de postos entre as variáveis X e Y, i.e, } \rho = 0$$
$$H_{1}: \text{Há correlação de postos entre as variáveis X e Y, i.e, } \rho \neq 0$$

A estatística do teste é justamente o próprio coeficiente de correlação de Spearman:

$$\rho = \frac{ \sum_{i=1}^{n} \Big[ \big( R(x_i) - \frac{n+1}{2} \big) \big( R(y_i)-\frac{n+1}{2} \big) \Big]}
{\sqrt{\sum_{i=1}^{n}  R^2(x_i) - n (\frac{n+1}{2})^{2}} . \sqrt{\sum_{i=1}^{n}  R^2(y_i) - n (\frac{n+1}{2})^{2}}}$$

E rejeita-se H_{0} caso:

$$\text{p-valor} = 2P(T > |r_{obs}|) < \alpha$$

**Teste de Breusch-Pagan**

Para testar homocedasticidade de variância do modelo, utilizamos o teste de Breusch-Pagan, em que é necessário a suposição de Normalidade e independência do erro. Além disso, a variância do termo $\varepsilon_i, \text{ denotada por } \sigma^2_i$ é relacionada aos níveis das variáveis X do seguinte modo:

$$\ln \sigma^2_i = \gamma_0 + \gamma_1 X_{i1} + \dots + \gamma_p X_{ip}$$

\newpage

em que as hipóteses do teste são:

$$H_{0}: \gamma_1 = \gamma_2 = \dots = \gamma_p$$ 
$$H_{1}: \exists \gamma_k \neq 0, \quad k = 1, \dots, p$$
 
Onde é efetuada a regressão do resíduo $e_i^2$ em relação às variáveis explicativas e obtém-se a soma de quadrados dessa regressão, denotada por $SQRes^*$, e a estatística do teste é $\chi^2_{BP}$ dada por:

$$\chi^2_{BP} = \frac{SQ_{RES}^*}{p + 1} \div \bigg(\frac{SQ_{RES}}{n} \bigg)^2 \sim \chi^2_p$$

Em que:

* $SQ_{RES}^*$ é a soma de quadrados de resíduos da regressão de Y em relação a $X_1, \dots, X_p$;
* $n$ é o tamanho da amostra.
 
**Teste de Normalidade de Shapiro-Wilk**

O teste de Shapiro-Wilk para Normalidade tem as hipóteses:

$$H_{0}: \text{A variável possui distribuição Normal}$$
$$H_{1}: \text{A variável não possui uma distribuição Normal}$$
 
A estatística do teste $W$ é dada por:

$$W=\frac{b^2}{\sum_{i=1}^n (X_{(i)}-\overline{X})^2}$$
 
Onde:

* $X_i$ são os valores da amostra ordenados;
* $\overline{X}$ é a média amostral;
* $a_{n - i + 1}$ são constantes geradas através das médias, variâncias e covariâncias das estatísticas de ordem de uma amostra de tamanho $n$ aproximadamente Normal;
* $b$ é uma constante constante denotada por:

$$b=\left\{\begin{array}{l} \sum_{i=1}^{\frac{n}{2}}a_{n-i+1}
(X_{(n-i+1)}-X_{(i)}), \ \hbox{se n for par} \\ \sum_{i=1}^{\frac{(n+1)}{2}}a_{n-i+1} (X_{(n-i+1)}-X_{(i)}), \ \hbox{se n for ímpar}\end{array}\right.$$

Rejeita-se a hipótese nula caso o p-valor associado à estatística encontrada $W$ seja inferior ao nível de significância $\alpha$.

\newpage

### Transformação na variável resposta

Quando as suposições de normalidade e ou homocedasticidade do erro do modelo são violadas, é necessário realizar uma transformação na variável resposta, afim de que a distribuição do resíduo se aproxime da distribuição normal.

As transformações mais comuns são:

* $Y' = \ln{Y}$;
* $Y' = \sqrt{Y}$;
* $Y' = 1/Y$.
 
Neste estudo a transformação realizada foi a de $Y' = \ln{Y}$.

, de acordo com \cite{neter1996applied} usa-se essa transformação quando o erro padrão, para cada nível do resíduo, é proporcional a média do nível, ou seja, se $\sigma_i$ for proporcional a $\mu_i$ a transformação indicada é $Y' = \ln{Y}$.

### Seleção de modelos

Nesse trabalho, selecionamos os modelos através dos coeficientes de determinação, coeficientes de determinação ajustado, critérios de Mallows, o de informação Bayesiano, além da seleção \textit{Backward}.

**Eliminação \textit{Backward}**

* Passo 1) Em primeiro lugar, ajusta-se um modelo com todas as variáveis explicativas. Após isso, calcula-se a estatística $t$ e seu respectivo p-valor para cada variável do modelo.

Se algum dos p-valores encontrados forem maiores que o nível de significância $\alpha$ estabelecido, então a variável é removida do modelo. Caso contrário, termina-se o procedimento.

* Passo 2) Assumindo a remoção de alguma variável, ajusta-se um novo modelo com todas as variáveis que continuam no modelo, e recalcula-se novas estatísticas $t$ e seus p-valores para cada variável do modelo.

Novamente, se algum p-valor for maior que $\alpha$, então a variável é removida do modelo. Caso contrário, termina-se o procedimento.

* Passo 3) Repete-se o passo 2 até o algoritmo não identificar mais variáveis que devem ser retiradas do modelo.

### Diagnóstico de Multicolinearidade
   
Para verificar o efeito de multicolinearidade nesse seminário, será usado o Fator de inflação da variância (VIF).
    
O VIF para o coeficiente $\beta_k$ é igual a:

$$(VIF)_k = (1 - R^2_k)^{-1}$$


Em que $R^2_k$ é o coeficiente de determinação múltiplo quanto $X_k$ é regredido com as outras $p - 1$ variáveis explicativas do modelo.

Nesse caso, o indicador de multicolinearidade costuma ser o maior valor de VIF dentre todas as variáveis. Então, se o maior valor de VIF for superior a 10, pode-se dizer que a multicolinearidade está influenciando as estimativas dos coeficientes $\beta_{k}$.

### Medidas de Influência

**DFFITS**

Está medida explica a influência que a observação $i$ tem sobre seu próprio valor ajustado:
  
  $$DFFITS(i) =\frac{ \hat{Y}_i - \hat{Y}_{i(i)}}{\sqrt{QME(i)h_{ii}}}$$
  
  Isso significa que a diferença dos valores preditos da variável reposta. Assim, esse método apresenta o quanto a omissão da observação i aumenta ou diminui o valor predito. 

Para saber se um ponto é influente segundo a medida DFFITS, será utilizado os seguintes pontos:

* $\mid DFFITS_{(i)} \mid > 1$ para amostras pequenas ou médias.

* $\mid DFFITS_{(i)} \mid > 2 \sqrt{(p+1)/n}$ para amostras grandes

sendo $(p+1)$ igual ao número de parâmetros.


**DFBETA**

Esta medida de influência (DFBETA) sobre o coeficiente de $X_j$ é definida por:
  
  $$DFBETA_{j(i)} = \frac{\hat{\beta}_j - \hat{\beta}_{j(i)}}{\sqrt{QME_ic_{jj}}}, \ \ j=0,1,...,p$$
  
  * $c_{jj}$ é o j-ésimo elemento da diagonal de $(X'X)^{-1}$
  
  O valor alto de DFBETA ndica que a observação $i$ influência na estimativa do coeficiente angular da variável explicativa $X_j$. Essa medida pode ser entendida das seguintes maneiras:
  
  * Caso o $\mid DFBETA \mid > 1$ para amostras pequenas ou médias, as observações serão consideradas influentes.

* Caso o $\mid DFBETA \mid > 2 / \sqrt{n}$ para amostras grandes, as observações serão consideradas influentes.

**Distância de Cook**

Esta medida de influência (Distância de Cook) é definida por:

$$D_i=\frac{e_i^2}{(p+1)QME} \frac{h_{ii}}{(1-h_{ii})^2}$$


As observações em que $D_i>1$, as observações serão influentes.

\newpage

### Medida de validação do modelo

**Erro de Predição do Qadrático Médio(MSPR)**

$$MSPR = \frac{\sum_{i=1}^n(Y_i-\hat{Y}_i)^2}{n^{*}}$$

onde:

* $Y_i$ - o valor da variável resposta para o i-ésimo caso da amostra de validação

* $\hat{Y}_i$ - valor predito para o i-ésimo caso da amostra de validação com base nos dados da amostra de construção do modelo

* $n^{*}$ - número de casos na amostra de validação

Caso o MSPR e o MSE forem valores próximos baseado no ajustamento do modelo, o MSE não é seriamente viesado e dá uma indicação da habilidade preditiva do modelo.

No entanto se o MSPR apresentar um valor consideravelmente maior que o MSE,  o MSPR deve ser usado como um indicador da habilidade preditiva, isto é uma medida da qualidade de predição do modelo selecionado.


\newpage

# Resultados 

## Análise Descritiva 

Nessa seção, estamos focados em apenas conhecer melhor os dados, sem a realização de testes e técnicas estatísticas formais. Dessa forma, iremos analisar as variáveis do banco de dados de forma subjetiva através de gráficos, tabelas e medidas descritivas adequadas.

### Univariada 

Para a análise univariada, evidentemente focaremos apenas em olhar uma variável de cada vez. Para tal, teremos diversas tabelas das mais diversas medidas descritivas (como média e quantis), além da presença de histogramas, boxplots e gráficos QQ, com o intuito de verificar a distribuição dos dados. Dessa forma:

**Variável X1 - Duração da Internação**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX1 = mean(dados$X1)
medianX1= median(dados$X1)
q1X1 = quantile(dados$X1, names=FALSE)[2]
q2X1 = quantile(dados$X1, names=FALSE)[3]
q3X1 = quantile(dados$X1, names=FALSE)[4]
q4X1 = quantile(dados$X1, names=FALSE)[5]
maxX1 = max(dados$X1)
minX1 = min(dados$X1)

varX1 = var(dados$X1)
sdX1 = sd(dados$X1)

d1X1 = quantile(dados$X1, seq(0, 1, 0.1), names=FALSE)[2]
d9X1 = quantile(dados$X1, seq(0, 1, 0.1), names=FALSE)[10]

skewX1 = 3*(meanX1 - medianX1)/sdX1
kurtX1 = (q3X1 - q1X1)/(2*(d9X1 - d1X1))
coef.varX1 = (sdX1/meanX1)*100

mX1 <- c(round(c(meanX1,minX1,q1X1,medianX1,q3X1,maxX1,varX1,sdX1,skewX1,kurtX1,coef.varX1),2))
nX1 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX1 <- data.frame(Medidas = nX1, Valores = mX1)
kable(variX1,caption = "Medidas de posição, variabilidade, assimetria e curtose")

```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X1,breaks = seq(6,24,4)))
kable(freq_salarios,col.names = c("Duração da Internação","Frequência"),caption = "Distribuição de frequência para Duração de Internação")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

graf11 <- ggplot(dados,aes(x=X1))+geom_histogram(colour="white",fill="darkslategray",binwidth=1)+
  labs(x="Duração da Internação", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black"))
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

graf12 <- ggplot(dados,aes(x=factor(""), y=X1))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Duração da Internação")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))

```

```{r fig.width = 6, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf11, graf12,ncol=2)
```

A variável Duração de Internação é uma variável quantitativa contínua e representa o média do tempo, em dias, uma pessoa fica internada em um determinado hospital. Analisando os gráficos e tabelas acima pode-se perceber que há uma baixa variância entre os dados, logo a maioria dos dados estão próximos a média, isso se pode perceber no boxplot. E também é nótorio que há outliers nessa amostra de 113 hospitais.

Agora vamos visualizar um gráfico para analisar de maneira exploratória se os dados dessa variável seguem a distribuição normal:

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 5, fig.height = 2,fig.align='center'}
ggplot(dados, aes(sample = X1)) +
  stat_qq(colour = "darkslategray") +
  labs(x="",y="Duração da Internação")+
  stat_qq_line()+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=12),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))
```

Tem-se que os dados aparentam seguir a normalidade, pois sua maioria se encontra em cima da linha de probabilidade ou próxima a ela. Porém há alguns pontos que se distanciam desta reta, gerando dúvida sobre uma possível afirmação. Para isso, será realizado o teste de Shapiro-Wilk com um nível de significância de 0.05 para testar sua normaliade.

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
shapiro.test(dados$X1)
```

Realizado o teste se obteve o $p-valor=3.26$x$10^{-09}$. Isso quer dizer que, que há evidências estatísticas suficiente para dizer que esse dados não seguem uma normal, com um nível de significância de 0.05.

\newpage

**Variável X2 - Idade** 


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX2 = mean(dados$X2)
medianX2= median(dados$X2)
q1X2 = quantile(dados$X2, names=FALSE)[2]
q2X2 = quantile(dados$X2, names=FALSE)[3]
q3X2 = quantile(dados$X2, names=FALSE)[4]
q4X2 = quantile(dados$X2, names=FALSE)[5]
maxX2 = max(dados$X2)
minX2 = min(dados$X2)

varX2 = var(dados$X2)
sdX2 = sd(dados$X2)

d1X2 = quantile(dados$X2, seq(0, 1, 0.1), names=FALSE)[2]
d9X2 = quantile(dados$X2, seq(0, 1, 0.1), names=FALSE)[10]

skewX2 = 3*(meanX2 - medianX2)/sdX2
kurtX2 = (q3X2 - q1X2)/(2*(d9X2 - d1X2))
coef.varX2 = (sdX2/meanX2)*100

mX2 <- c(round(c(meanX2,minX2,q1X2,medianX2,q3X2,maxX2,varX2,sdX2,skewX2,kurtX2,coef.varX2),2))
nX2 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX2 <- data.frame(Medidas = nX2, Valores = mX2)
kable(variX2,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```



```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X2,breaks = seq(35,70,7)))
kable(freq_salarios,col.names = c("Idade","Frequência"),caption = "Distribuição de frequência para Idade")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}

graf21 <- (ggplot(dados,aes(x=X2))+geom_histogram(colour="white",fill="darkslategray",binwidth=5)+
  labs(x="Idade", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}

graf22 <- (ggplot(dados,aes(x=factor(""), y=X2))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Idade")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf21, graf22,ncol=2)
```

A variável 'Idade' é uma variável quantitativa contínua que tem como significado a idade média dos pacientes de um determinado hospital. Realizando uma análise exploratória tem-se que mais da metade dos pacientes dos hospitais tem uma média superior a 53,20 anos, o coeficiente de variação nos apresenta que há baixa dispersão dos dados, logo os dados tendem a ficar mais próximo da média de 53,23 anos.


\newpage

**Variável X3 - Risco de Infecção**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX3 = mean(dados$X3)
medianX3= median(dados$X3)
q1X3 = quantile(dados$X3, names=FALSE)[2]
q2X3 = quantile(dados$X3, names=FALSE)[3]
q3X3 = quantile(dados$X3, names=FALSE)[4]
q4X3 = quantile(dados$X3, names=FALSE)[5]
maxX3 = max(dados$X3)
minX3 = min(dados$X3)

varX3 = var(dados$X3)
sdX3 = sd(dados$X3)

d1X3 = quantile(dados$X3, seq(0, 1, 0.1), names=FALSE)[2]
d9X3 = quantile(dados$X3, seq(0, 1, 0.1), names=FALSE)[10]

skewX3 = 3*(meanX3 - medianX3)/sdX3
kurtX3 = (q3X3 - q1X3)/(2*(d9X3 - d1X3))
coef.varX3 = (sdX3/meanX3)*100

mX3 <- c(round(c(meanX3,minX3,q1X3,medianX3,q3X3,maxX3,varX3,sdX3,skewX3,kurtX3,coef.varX3),2))
nX3 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX3 <- data.frame(Medidas = nX3, Valores = mX3)
kable(variX3,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X3,breaks = seq(1,10,2)))
kable(freq_salarios,col.names = c("Risco de Infecção","Frequência"),caption = "Distribuição de frequência para Risco de Infecção")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf31 <- (ggplot(dados,aes(x=X3))+geom_histogram(colour="white",fill="darkslategray",binwidth=1)+
  labs(x="Risco de Infecção", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf32 <- (ggplot(dados,aes(x=factor(""), y=X3))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Risco de Infecção")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 2.3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf31, graf32,ncol=2)
```

A variável "Risco de infecção" tem como descrição a probabilidade média(em porcentagem) estimada de algum paciente contrair uma doença quando está presente em um determinado hospital. A variável em questão é classificada como quantitativa contínua. Analisando os dados se obtem alguma informações. Tem-se um coeficiente de variação alto, ou seja, alguns hospitais se divergem muito em alguns aspectos que podem causar infecção de alguns pacientes por causa do ambiente hospitalar, limpeza e tipo de tratamento especifico de uma determinada doença em um hospital especializado podem ser algo que ajude a explicar essa grande variação. Essa varição elevada pode ser influenciada pelos outliers presente no banco de dados. O maior risco que a pessoa tem para se infectar em um determiado hospital foi de 7,80%, enquanto o menor risco foi de 1,30% 




**Variável X4 - Proporção de Culturas de Rotina**



```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX4 = mean(dados$X4)
medianX4= median(dados$X4)
q1X4 = quantile(dados$X4, names=FALSE)[2]
q2X4 = quantile(dados$X4, names=FALSE)[3]
q3X4 = quantile(dados$X4, names=FALSE)[4]
q4X4 = quantile(dados$X4, names=FALSE)[5]
maxX4 = max(dados$X4)
minX4 = min(dados$X4)

varX4 = var(dados$X4)
sdX4 = sd(dados$X4)

d1X4 = quantile(dados$X4, seq(0, 1, 0.1), names=FALSE)[2]
d9X4 = quantile(dados$X4, seq(0, 1, 0.1), names=FALSE)[10]

skewX4 = 3*(meanX4 - medianX4)/sdX4
kurtX4 = (q3X4 - q1X4)/(2*(d9X4 - d1X4))
coef.varX4 = (sdX4/meanX4)*100

mX4 <- c(round(c(meanX4,minX4,q1X4,medianX4,q3X4,maxX4,varX4,sdX4,skewX4,kurtX4,coef.varX4),2))
nX4 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX4 <- data.frame(Medidas = nX4, Valores = mX4)
kable(variX4,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X4,breaks = seq(1,70,10)))
kable(freq_salarios,col.names = c("Proporção de Culturas de Rotina","Frequência"),caption = "Distribuição de frequência para Risco da Proporção de Culturas de Rotina")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf41 <- (ggplot(dados,aes(x=X4))+geom_histogram(colour="white",fill="darkslategray",binwidth=5)+
  labs(x="Proporção de Culturas de Rotina", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf42 <- (ggplot(dados,aes(x=factor(""), y=X4))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de Culturas de Rotina")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 2.3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf41, graf42,ncol=2)
```

A variável "Proporção de Culturas de Rotina" é classificada como uma variável quantitativa contínua. Ela tem como significado razão do número de culturas realizadas com relação ao número de pacientes sem sinais ou sintomas de infeção adquirida no hospital, vezes 100. Analisando o boxplot percebemos que os dados acima da mediana são muito afastados, isso pode ser o fato do coeficiente de variação estar elevado. Com isso, percebe-se que o histograma é assimétrico a direita.


\newpage

**Variável X5 - Proporção de Raio - X de Tórax de Rotina**



```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX5 = mean(dados$X5)
medianX5= median(dados$X5)
q1X5 = quantile(dados$X5, names=FALSE)[2]
q2X5 = quantile(dados$X5, names=FALSE)[3]
q3X5 = quantile(dados$X5, names=FALSE)[4]
q4X5 = quantile(dados$X5, names=FALSE)[5]
maxX5 = max(dados$X5)
minX5 = min(dados$X5)

varX5 = var(dados$X5)
sdX5 = sd(dados$X5)

d1X5 = quantile(dados$X5, seq(0, 1, 0.1), names=FALSE)[2]
d9X5 = quantile(dados$X5, seq(0, 1, 0.1), names=FALSE)[10]

skewX5 = 3*(meanX5 - medianX5)/sdX5
kurtX5 = (q3X5 - q1X5)/(2*(d9X5 - d1X5))
coef.varX5 = (sdX5/meanX5)*100

mX5 <- c(round(c(meanX5,minX5,q1X5,medianX5,q3X5,maxX5,varX5,sdX5,skewX5,kurtX5,coef.varX5),2))
nX5 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX5 <- data.frame(Medidas = nX5, Valores = mX5)
kable(variX5,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X5,breaks = seq(35,140,15)))
kable(freq_salarios,col.names = c("Proporção de Raio - X de Tórax de Rotina","Frequência"),caption = "Distribuição de frequência para Proporção de Raio - X de Tórax de Rotina")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf51 <- (ggplot(dados,aes(x=X5))+geom_histogram(colour="white",fill="darkslategray",binwidth=14)+
  labs(x="Proporção de Raio - X de Tórax de Rotina", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf52 <- (ggplot(dados,aes(x=factor(""), y=X5))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de Raio - X de Tórax de Rotina")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 2.2,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf51, graf52,ncol=2)
```

A variável "Proporção de Raio-X de Tórax de Rotina" tem como classificação ser uma variável quantitativa contínua pois representa a razão da quantidade de Raio-X de Tórax realizados em um determinado hospital com relação ao valor de pacientes com o sintomas da pneumonia ou sem sinais da doença, vezes 100. Observado os dados obtidos acima tem-se que os dados tem média dispersão pelo coeficiente de Variação. Analasiando visualmente os dados parece que eles tedem a seguir uma distribuição normal com leve assimetria a direita. 


\newpage

**Variável X6 - Número de leitos**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX6 = mean(dados$X6)
medianX6= median(dados$X6)
q1X6 = quantile(dados$X6, names=FALSE)[2]
q2X6 = quantile(dados$X6, names=FALSE)[3]
q3X6 = quantile(dados$X6, names=FALSE)[4]
q4X6 = quantile(dados$X6, names=FALSE)[5]
maxX6 = max(dados$X6)
minX6 = min(dados$X6)

varX6 = var(dados$X6)
sdX6 = sd(dados$X6)

d1X6 = quantile(dados$X6, seq(0, 1, 0.1), names=FALSE)[2]
d9X6 = quantile(dados$X6, seq(0, 1, 0.1), names=FALSE)[10]

skewX6 = 3*(meanX6 - medianX6)/sdX6
kurtX6 = (q3X6 - q1X6)/(2*(d9X6 - d1X6))
coef.varX6 = (sdX6/meanX6)*100

mX6 <- c(round(c(meanX6,minX6,q1X6,medianX6,q3X6,maxX6,varX6,sdX6,skewX6,kurtX6,coef.varX6),2))
nX6 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX6 <- data.frame(Medidas = nX6, Valores = mX6)
kable(variX6,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X6,breaks = seq(25,900,125)))
kable(freq_salarios,col.names = c("Proporção de Número de leitos","Frequência"),caption = "Distribuição de frequência para número de leitos")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf61 <- (ggplot(dados,aes(x=X6))+geom_histogram(colour="white",fill="darkslategray",binwidth=80)+
  labs(x="Proporção de número de leitos", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.3,fig.align='center'}

graf62 <- (ggplot(dados,aes(x=factor(""), y=X6))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de número de leitos")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 2.3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf61, graf62,ncol=2)
```

A variável "Número de leitos" é classificada como variável quantitativa contínua e representa a quantidade média de leitos em um determinado hospital durante o período de estudo. Foi verificado que a partir da amostra retirada que o coeiciente de variação é muito alto, e essa heterogeneidade dos dados pode ser percebida pelos gráficos, pontos de outlier e uma grande variação. Perce-se que algumas medidas sofrem influência direta com esses pontos mais afastados.

\newpage

**Variável X7 - Filiação a Escola de Medicina**



```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq1 <- sum(dados1$X7 == "Sim")
freq2 <- sum(dados1$X7 == "Não")
perc1 <- round(freq1/length(dados1$X7),2)
perc2 <- round(freq2/length(dados1$X7),2)

freq.X7 <- c(freq1,freq2)
porc.X7 <- c(perc1,perc2)
x7 <- c("Sim", "Não")
tabelax7 <- data.frame(x7,freq.X7,porc.X7)
```


```{r fig.width = 3, fig.height = 2, fig.align="center", message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

kable(tabelax7, col.names = c("X7", "Frequência","Porcentagem"))

ggplot(dados1, aes(x = X7)) + 
  geom_bar( fill=c("#69d171","#d96464")) + 
  labs(x="Filiação a Escola de Medicina" , y="Frequência") + 
  theme_bw() +
  theme( axis.title.y=element_text(colour="black" , size=12) , 
         axis.title.x = element_text(colour="black" , size=12) , 
         axis.text = element_text(colour = "black" , size=9.5) , 
         panel.border = element_blank () , 
         axis.line = element_line(colour = "black"),
         plot.title = element_text(size=12,hjust=0.3,
                                   colour="black"))
```

A variável "Filiação a Escola de Medicina" representa se um determinado hospital tem uma ligação com a Escola de Medicina. A classificação dessa variável é qualitativa nominal. Observando os dados percebemos que 85% dos hospitais que foram representados na amostra não possuem uma filiação com a Escola de Medicina e que 15% dos hospitais possuem uma ligação com a Escola de Medicina.


**Variável X8 - Região**


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq11 <- sum(dados1$X8 == "NE");perc11 <- round(freq11/length(dados1$X8),2)
freq22 <- sum(dados1$X8 == "NC");perc22 <- round(freq22/length(dados1$X8),2)
freq33 <- sum(dados1$X8 == "S");perc33 <- round(freq33/length(dados1$X8),2)
freq44 <- sum(dados1$X8 == "W");perc44 <- round(freq44/length(dados1$X8),2)


freq.X8 <- c(freq11,freq22,freq33,freq44)
porc.X8 <- c(perc11,perc22,perc33,perc44)
x8 <- c("NE", "NC","S","W")
tabelax8 <- data.frame(x8,freq.X8,porc.X8)
```


```{r fig.width = 3, fig.height = 2, fig.align="center", message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

kable(tabelax8, col.names = c("X8", "Frequência","Porcentagem"))

ggplot(dados1, aes(x = X8)) + 
  geom_bar( fill=c("#69d171","#d96464","#99aae8","#d09ff5")) + 
  labs(x="Região" , y="Frequência") + 
  theme_bw() +
  theme( axis.title.y=element_text(colour="black" , size=12) , 
         axis.title.x = element_text(colour="black" , size=12) , 
         axis.text = element_text(colour = "black" , size=9.5) , 
         panel.border = element_blank () , 
         axis.line = element_line(colour = "black"),
         plot.title = element_text(size=12,hjust=0.3,
                                   colour="black"))
```

A variável "Região" é classificada como uma variável qualitativa nominal e representa em qual região um determinado hospital de localiza. Percebemos que a maioria dos hospitais se encontram na região S com 33% dos hospitais e que a menor quantidade de hospitais de encontra na região W, com 14% dos hospitais. O restante dos hospitais (53%) estão localizados nas regiões NE e NC.

\newpage

**Variável X9 - Média diárias de pacientes**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX9 = mean(dados$X9)
medianX9= median(dados$X9)
q1X9 = quantile(dados$X9, names=FALSE)[2]
q2X9 = quantile(dados$X9, names=FALSE)[3]
q3X9 = quantile(dados$X9, names=FALSE)[4]
q4X9 = quantile(dados$X9, names=FALSE)[5]
maxX9 = max(dados$X9)
minX9 = min(dados$X9)

varX9 = var(dados$X9)
sdX9 = sd(dados$X9)

d1X9 = quantile(dados$X9, seq(0, 1, 0.1), names=FALSE)[2]
d9X9 = quantile(dados$X9, seq(0, 1, 0.1), names=FALSE)[10]

skewX9 = 3*(meanX9 - medianX9)/sdX9
kurtX9 = (q3X9 - q1X9)/(2*(d9X9 - d1X9))
coef.varX9 = (sdX9/meanX9)*100

mX9 <- c(round(c(meanX9,minX9,q1X9,medianX9,q3X9,maxX9,varX9,sdX9,skewX9,kurtX9,coef.varX9),2))
nX9 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX9 <- data.frame(Medidas = nX9, Valores = mX9)
kable(variX9,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X9,breaks = seq(20,820,100)))
kable(freq_salarios,col.names = c("Proporção de Média diárias de pacientes","Frequência"),caption = "Distribuição de frequência para média diárias de pacientes")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf91 <- (ggplot(dados,aes(x=X9))+geom_histogram(colour="white",fill="darkslategray",binwidth=100)+
  labs(x="Proporção de média diárias de pacientes", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf92 <- (ggplot(dados,aes(x=factor(""), y=X9))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de média diárias de pacientes")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 2.2,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf91, graf92,ncol=2)
```


A variável "Média diária de pacientes" é classificada como quantitativa contínua e representa quantos pacientes em média foram por dia a um determinado hospital durante o período de estudo. Observando as tabelas e os gráficos referentes a essa variável tem-se um coeficiente de variância muito alto. Os valores acima da mediana se apresentam de forma bastante heterogênea. Percebe-se uma assimetria a direita e vários outliers nessa amostra, podendo ser influenciadores do aumento dos valores de algumas medidas.

\newpage

**Variável X10 - Número de enfermeiro(s)**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX10 = mean(dados$X10)
medianX10= median(dados$X10)
q1X10 = quantile(dados$X10, names=FALSE)[2]
q2X10 = quantile(dados$X10, names=FALSE)[3]
q3X10 = quantile(dados$X10, names=FALSE)[4]
q4X10 = quantile(dados$X10, names=FALSE)[5]
maxX10 = max(dados$X10)
minX10 = min(dados$X10)

varX10 = var(dados$X10)
sdX10 = sd(dados$X10)

d1X10 = quantile(dados$X10, seq(0, 1, 0.1), names=FALSE)[2]
d9X10 = quantile(dados$X10, seq(0, 1, 0.1), names=FALSE)[10]

skewX10 = 3*(meanX10 - medianX10)/sdX10
kurtX10 = (q3X10 - q1X10)/(2*(d9X10 - d1X10))
coef.varX10 = (sdX10/meanX10)*100

mX10 <- c(round(c(meanX10,minX10,q1X10,medianX10,q3X10,maxX10,varX10,sdX10,skewX10,kurtX10,coef.varX10),2))
nX10 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX10 <- data.frame(Medidas = nX10, Valores = mX10)
kable(variX10,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X10,breaks = seq(10,710,100)))
kable(freq_salarios,col.names = c("Proporção de Número de enfermeiro(s)","Frequência"),caption = "Distribuição de frequência para número de enfermeiro(s)")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}

graf101 <- (ggplot(dados,aes(x=X10))+geom_histogram(colour="white",fill="darkslategray",binwidth=100)+
  labs(x="Proporção de número de enfermeiro(s)", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}

graf102 <- (ggplot(dados,aes(x=factor(""), y=X10))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de número de enfermeiro(s)")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```

```{r fig.width = 6, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf101, graf102,ncol=2)
```

\newpage

A variável "número de enfermeiro(s)" representa a quantidade média de enfermeiros(as) que trabalharam em tempo-integral ou equivalente registrados e licenciados durante o período de estudo o ( número de tempos integrais+metade do número de tempo parcial). Esta variável é classificada como quantitativa contínua. Percebe-se nas informações extraídas da amostra de 113 observações que essa variável possui um coeficiente de variância muito elevado, outliers e tem uma assimetria a direita. 

O gráfico abaixo reprenta a distribuição de probabilidade normal e com ele poderemos analisar de uma forma visual se esses dados sobre o número de enfermeiros seguem esta distribuição. 

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 5, fig.height = 2,fig.align='center'}
ggplot(dados, aes(sample = X10)) +
  stat_qq(colour = "darkslategray") +
  labs(x="",y="Número de enfermeiro(s)")+
  stat_qq_line()+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=12),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))
```

Após a análise do gráfico, podemos perceber que grande parte das obervações estam distantes da linha de referência para a distribuição normal, estão tem-se uma suposição que os dados dessa variável não seguem uma distribuição normal, mas será feito o teste de Shapiro-Wilk para comprovar se realmente está afirmação está correta. Será utilizado um nível de significância de 0.05.

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
shapiro.test(dados$X10)
```

Após realizar o teste, obteve-se um $p-valor=5.932$x$10^{-09}$. Esta informação nos apresenta que há evidências estatísticas suficientes para dizer que esses dados não seguem uma distribuição normal, com um nível de significância de 0.05. Isso comprova o que foi analisado anteriormente.


\newpage

**Variável X11 - Facilidades e serviços disponíveis**


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
meanX11 = mean(dados$X11)
medianX11= median(dados$X11)
q1X11 = quantile(dados$X11, names=FALSE)[2]
q2X11 = quantile(dados$X11, names=FALSE)[3]
q3X11 = quantile(dados$X11, names=FALSE)[4]
q4X11 = quantile(dados$X11, names=FALSE)[5]
maxX11 = max(dados$X11)
minX11 = min(dados$X11)

varX11 = var(dados$X11)
sdX11 = sd(dados$X11)

d1X11 = quantile(dados$X11, seq(0, 1, 0.1), names=FALSE)[2]
d9X11 = quantile(dados$X11, seq(0, 1, 0.1), names=FALSE)[10]

skewX11 = 3*(meanX11 - medianX11)/sdX11
kurtX11 = (q3X11 - q1X11)/(2*(d9X11 - d1X11))
coef.varX11 = (sdX11/meanX11)*100

mX11 <- c(round(c(meanX11,minX11,q1X11,medianX11,q3X11,maxX11,varX11,sdX11,skewX11,kurtX11,coef.varX11),2))
nX11 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo","Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX11 <- data.frame(Medidas = nX11, Valores = mX11)
kable(variX11,caption = "Medidas de posição, variabilidade, assimetria e curtose")
```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
freq_salarios <- table(cut(dados$X11,breaks = seq(5,85,10)))
kable(freq_salarios,col.names = c("Proporção de facilidades e serviços disponíveis","Frequência"),caption = "Distribuição de frequência para facilidades e serviços disponíveis")
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf111 <- (ggplot(dados,aes(x=X11))+geom_histogram(colour="white",fill="darkslategray",binwidth=10)+
  labs(x="Proporção de facilidades e serviços disponíveis", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=9),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 2.2,fig.align='center'}

graf112 <- (ggplot(dados,aes(x=factor(""), y=X11))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de facilidades e serviços disponíveis")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=9),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

```


```{r fig.width = 6, fig.height = 2.2,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
grid.arrange(graf111, graf112,ncol=2)
```

A variável em estudo "Facilidades e serviços disponíveis" é classificada como uma variável quantitativa contínua. Ela representa a porcentagem de 35 serviços e facilidades que são fornecidos pelo hospital. Analisando os gráficos e tabelas obtidas tem-se que os dados tem uma média dispersão. Visualmente eles aparentam a seguir uma distribuição normal. Sua mediana é igual a 42.90 tendo seu máximo igual a 80 e seu mínimo igual a 5.70.  

\newpage

### Bivariada

Para a análise bivariada das variáveis, vamos focar apenas naquelas referentes aos seus respectivos modelos. Na prática, isso significa que iremos analisar a variável resposta do modelo com cada uma de suas variáveis explicativas, a fim de obter resultados mais práticos e diretos sobre as questões desse seminário.

#### Modelo 1


**Região x Enfermeiros**

Para essas duas variáveis, teremos um boxplot como gráfico adequado; isso se deve ao fato de número de enfermeiros ser quantitativa, e a região ser qualitativa. Portanto:

```{r fig.width = 4, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
ggplot(dados, aes(x = X8, group = X8, y = X10))+
  geom_boxplot(fill = c("#69d171","#d96464","#99aae8","#d09ff5"))+
  theme_minimal()+
  xlab("Região")+
  ylab("Número de Enfermeiros")
```

No gráfico, vemos sutis diferenças entres os boxplots, o que nos sugere uma pequena correlação entre as duas variáveis; além disso, podemos notar também a presença de vários outliers em todas as regiões. Abaixo, temos uma tabela com a frequência esperada (número total de enfermeiros dividido pela quantidade de regiões), e a frequência observada para cada região:


```{r fig.width = 4, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
x <- dados %>%
  group_by(X8) %>%
  summarise("Freq. Observada" = sum(X10)) %>%
  mutate("Freq. Esperada" = sum(dados$X10)*0.25) %>%
  mutate(Região = fct_recode(X8, "NE" = "1", "NC" = "2",
                                             "S" = "3", "W" = "4"))

x <- data.frame(x$Região, x$`Freq. Observada`, x$`Freq. Esperada`)
names(x) <- c("Região", "Freq. Observada", "Freq. Esperada")

kable(x, caption = "Tabela de Freq. do Número de Enfermeiros por Região")
```

Curiosamente, vemos que três das regiões tem um número de enfermeiros superior ao valor esperado, e apenas a região "W" tem uma frequência muito abaixo do esperado. 

\newpage

**Facilidades e Serviços x Enfermeiros**

Por fim, temos duas variáveis quantitativas, sendo a porcentagem de facilidade e serviços disponíveis do hospital e seu respectivo número de enfermeiros. Logo, temos a dispersão no gráfico abaixo:

```{r fig.width = 4, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
ggplot(dados, aes(X11, X10))+
  geom_point(color = "darkslategray")+
  geom_smooth(se = F, color = "black")+
  theme_minimal()+
  xlab("Facilidades e Serviços disponíveis (%)")+
  ylab("Número de Enfermeiros")
```

Acima, vemos o que parece ser uma forte e positiva correlação não-linear entre as duas variáveis. Então, temos como medida descritiva da associação os respectivos $\rho$'s:

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
x <- data.frame(round(cor(dados$X11, dados$X10, method = "spearman"), 3),
                round(cor(amostra1$X11, amostra1$X10, method = "spearman"), 3),
                round(cor(amostra2$X11, amostra2$X10, method = "spearman"), 3))
names(x) <- c("Dados Completos", "Amostra 1", "Amostra 2")

kable(x)
```

Sendo assim, vemos que o $\rho$ encontrados variam entre 0.80 e 0.90, o que dá mais indícios da forte correlação entre as variáveis.

\newpage


#### Modelo 2

  **Relação entre Duração da Internação e Idade**
  
  Como ambas variáveis são quantitativas, vamos utilizar o gráfico de dispersão e o coeficiente de correlação linear de Pearson para vermos se há alguma correlação.

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 3.5, fig.height = 1.8,fig.align='center'}
ggplot(dados, aes(X2,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Idade(X2)")




knitr::kable(cbind(round(cor(dados$X2,dados$X1), 3),
                   round(cor(amostra1$X2,amostra1$X1), 3),
                   round(cor(amostra2$X2,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))
```

Através do gráfico e da tabela 1, vemos que a correlação entre a duração de internação e idade parece ser fraca, mas veremos se no modelo de regressão a idade contribuirá para explicar a duração de internação.



**Relação entre Duração da Internação e Risco de Infecção**
  
  Neste caso também temos duas variáveis quantitativas, logo:
  
```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 3.5, fig.height = 1.8,fig.align='center'}
ggplot(dados, aes(X3,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Risco de infecção(X3)")

knitr::kable(cbind(round(cor(dados$X3,dados$X1), 3),
                   round(cor(amostra1$X3,amostra1$X1), 3),
                   round(cor(amostra2$X3,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))
```

Aqui vemos uma correlação linear positiva moderada entre a duração de internação e o risco de infecção, o que faz sentido se pensarmos que quanto maior o risco de infecção, maior o tempo de internação do paciente.

\newpage

**Relação entre Duração da Internação e Número de leitos**
  
  
  
```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 3.5, fig.height = 2,fig.align='center'}
ggplot(dados, aes(X6,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Número de leitos(X6)")

knitr::kable(cbind(round(cor(dados$X6,dados$X1), 3),
                   round(cor(amostra1$X6,amostra1$X1), 3),
                   round(cor(amostra2$X6,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))
```

Neste caso também vemos uma correlação linear positiva moderada entre a duração de internação e o número de leitos, o que parece mostrar que quanto maior o hospital, mais dias o paciente ficará internado.

**Relação entre Duração da Internação e Filiação a Escola de Medicina**
  
  Neste caso temos uma variável qualitativa e uma quantitativa, realizando as análises de acordo.

```{r message=FALSE, warning=FALSE, echo=F,fig.width = 4.5, fig.height = 3.5,fig.align='center'}
ggplot(dados, aes(X7,X1))+
  geom_boxplot(fill = c("#69d171","#d96464"))+
  theme_minimal()+
  labs(y = "Duração da internação(X1)", x = "Filiação a Escola de Medicina(X7)")+
  scale_x_discrete(labels=c("1" = "Sim", "2" = "Não"))


ggplot(dados, aes(X1))+
  geom_histogram(aes(), color = "black", fill = "darkslategrey")+
  theme_minimal()+
  facet_wrap(~X7, labeller = as_labeller(c("1" = "Sim", "2" = "Não")))+
  theme(strip.background =element_rect(fill="skyblue"))+
  labs( x = "Duração da internação(X1)", y = "Contagem",title = "Distribuição dos dias de internação por filiação")


x1 <- amostra1 %>%
  group_by(X7) %>%
  summarise("Freq. absoluta amostra1" = n(),"Freq. relativa amostra1" = n()/57) %>%
  mutate(`Filiação amostra1`  = fct_recode(X7,
                                           "Sim" = "1",
                                           "Não" = "2")) %>% 
  select(4,2,3)

x2 <- amostra2 %>%
  group_by(X7) %>%
  summarise("Freq. absoluta amostra2" = n(),"Freq. relativa amostra2" = n()/56) %>%
  mutate(`Filiação amostra2`  = fct_recode(X7,
                                           "Sim" = "1",
                                           "Não" = "2")) %>% 
  select(4,2,3)

x3 <- dados %>%
  group_by(X7) %>%
  summarise("Freq. absoluta dados" = n(),"Freq. relativa dados" = n()/113) %>%
  mutate(`Filiação dados` = fct_recode(X7,
                                       "Sim" = "1",
                                       "Não" = "2")) %>% 
  select(4,2,3)


x <- list(x1,x2,x3)



knitr::kable(x, caption = "Tabela da Freq. dos dias de internação por filiação")


```

Com base na tabela e nos gráficos vemos que as distribuições com relação a filiação se assemelham, porém os hospitais com filiação a escola de medicina parecem ter valores ligeiramente maiores com relação aos que não tem.

\newpage

**Relação entre Duração da Internação e Região**
  
  Aqui também temos uma variável quantitativa e outra qualitativa, logo:
  
```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 5, fig.height = 4,fig.align='center'}
ggplot(dados, aes(X8,X1))+
  geom_boxplot(fill = c("#69d171","#d96464","#99aae8","#d09ff5"))+
  theme_minimal()+
  labs(y = "Duração da internação(X1)", x = "Região(X8)")+
  scale_x_discrete(labels=c("1" = "NE", "2"= "NC", "3" = "S",   "4" = "W"))


ggplot(dados, aes(X1))+
  geom_histogram(aes(), color = "black", fill = "darkslategrey")+
  theme_minimal()+
  facet_wrap(~X8, labeller = as_labeller(c("1" = "NE", "2"= "NC", "3" = "S",   "4" = "W")))+
  theme(strip.background =element_rect(fill="skyblue"))+
  labs( x = "Duração da internação(X1)", y = "Contagem",title = "Distribuição dos dias de internação por região")


x11 <- amostra1 %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/57) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,    "W" ="4")) %>% 
  select(4,2,3)

x22 <- amostra2 %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/56) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,    "W" ="4")) %>% 
  select(4,2,3)


x33 <- dados %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/113) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,    "W" ="4")) %>% 
  select(4,2,3)


knitr::kable(list(x11,x22,x33), caption = "Tabela da Freq. dos dias de internação por região")


```

Com base na tabela e gráficos acima parece haver uma associação entre a região e a quantidade de dias que o paciente fica internado.

**Relação entre Duração da Internação e Média diária de pacientes**
  
  Neste caso há duas variáveis quantitativas, portanto:
  
```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}
ggplot(dados, aes(X9,X1))+
  geom_point(color = "darkslategrey")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Média diária de pacientes(X9)")

knitr::kable(cbind(round(cor(dados$X9,dados$X1), 3),
                   round(cor(amostra1$X9,amostra1$X1), 3),
                   round(cor(amostra2$X9,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))
```


Pela análise acima parece haver uma correlação linear positiva moderada entre a média diária de pacientes e a duração de internação em dias, já que em dias com muitos pacientes a duração de internação é ligeiramente maior.

\newpage

**Relação entre Duração da Internação e Número de enfermeiro(s)**
  
  Por fim também temos duas variáveis quantitativas, logo:
  
```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F,fig.width = 4, fig.height = 3,fig.align='center'}
ggplot(dados, aes(X10,X1))+
  geom_point(color = "darkslategrey")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Número de infermeiros(X10)")

knitr::kable(cbind(round(cor(dados$X10,dados$X1), 3),
                   round(cor(amostra1$X10,amostra1$X1), 3),
                   round(cor(amostra2$X10,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))
```

Aqui vemos uma correlação linear positiva moderada, o que parece seguir contra a intuição de que em hospitais com mais infermeiros, os pacientes tendem a ficar menos dias internados.

\newpage


## Modelo 1

### Modelo Completo

O modelo 2 completo tem a seguinte forma inicial:

$$Y_i=\beta_0+\beta_1 x_{i1}+\beta_{11}x^2_{i1}+\beta_{21} X_{i21}+\beta_{22} X_{i22}+\beta_{23} X_{i23}$$

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
xi1 <- banco.modelo1$X1 - mean(banco.modelo1$X1)

modelo1.completo <- lm(banco.modelo1$Y~xi1 + I(xi1^2)+banco.modelo1$X21+ banco.modelo1$X22+ banco.modelo1$X23)

#summary(modelo1.completo)

nomes <- c("Intercepto","$x_{i1}$","$x_{i1}^2$","$X_{21}$","$X_{22}$","$X_{23}$")

kable(cbind(nomes,summary(modelo1.completo)[["coefficients"]]),col.names = c("Variáveis","Estimativas","Erro Padrão","Estatística","P-valor"),row.names = FALSE)
```

Analisando a tabela acima, podemos ver que as variáveis $X_{21}$,$X_{22}$,$X_{23}$, que são as variáveis indicadoras da região, não são significativas para o modelo completo.

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
df <- data.frame(F = 45.64,
                 glnum = 5,
                 gldem = 51,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador","Graus de Liberdade Denominador","P-valor"))
```

A tabela acima é referente ao teste de ausência de regressão. Como o p-valor é menor que o nível de significância, há evidêcias estatísticas suficientes para dizer que há regressão neste modelo. 


```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(data.frame("1" = c(70.14),
                 "2" = c(51)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))
```

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(cbind(0.8174, 0.7994), col.names = c("$R^2$", "$R^2_{ajustado}$"))
```

Com isso, temos que o erro padrão estimado para o modelo completo é 70.14, com 51 graus de liberdade. Note que esta é a estimativa para o $\sigma$. Já o $R^2_{ajustado}$ obtido foi 0.7994, isso significa que as variáveis do modelo conseguem explicar quase 80% da quantidade média de enfermeiros(as) no hospital(i).

\newpage

#### Verificação dos pressupostos

Os itens a serem verificados são:

* Função de Regressão linear;
* Os erros do modelo tem variância constante;
* Os erros são independentes;
* Os erros são normalmente distribuidos.
* Não foram omitida variáveis explicativas importantes do modelo. 


```{r  fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo1.completo, aes(modelo1.completo$fitted.values,modelo1.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo1, aes(X1,modelo1.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")

c <- ggplot(banco.modelo1, aes(sample = modelo1.completo$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()


grid.arrange(a,b,c,nrow=2,ncol=2)



```



Analisando os resíduos do modelo, verificamos que a função de regressão não é linear, além de que as variâncias não parecem ser homogêneas e independentes, visto que pelo gráfico de valores ajustados x resíduos os valores dos resíduos estão menos dispersos para valores ajustados menores. Pelo gráfico qq, observa-se que os resíduos não seguem uma distribuição normal. Então para confirmar as suposições de falta homogêneidade e a normalidade dos resíduos, serão feitos testes estatísticos apropriados.   



```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo1.completo$residuals)
bp <- bptest(lm(banco.modelo1$Y~xi1 + I(xi1^2)+banco.modelo1$X21+ banco.modelo1$X22+ banco.modelo1$X23))
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))
```


Com os resultados obtidos, temos evidências estatísticas suficientes para dizer que os resíduos não são homogêneos, porém são normalmente distribuidos.

\newpage

### Modelo Transformado

Para corrigir o problema de homogeneidade, vamos aplicar uma transformação na variável $Y$ da seguinte forma:

$$\ln(Y)_i=\beta_0+\beta_1 x_{i1}+\beta_{11}x^2_{i1}+\beta_{21} X_{i21}+\beta_{22} X_{i22}+\beta_{23} X_{i23}$$

Obtemos a seguinte tabela do modelo transformado:

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

modelo1.trans <- lm(log(banco.modelo1$Y)~xi1 + I(xi1^2)+banco.modelo1$X21+ banco.modelo1$X22+ banco.modelo1$X23)

#summary(modelo1.trans)

nomes <- c("Intercepto","$x_{i1}$","$x_{i1}^2$","$X_{21}$","$X_{22}$","$X_{23}$")

kable(cbind(nomes,summary(modelo1.trans)[["coefficients"]]),col.names = c("Variáveis","Estimativas","Erro Padrão","Estatística","P-valor"),row.names = FALSE)
```

Analisando a tabela acima, podemos ver que as variáveis $X_{21}$,$X_{22}$,$X_{23}$ e $x^2_{i1}$,  não são significativas para o modelo completo transformado.

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
df <- data.frame(F = 45.03,
                 glnum = 5,
                 gldem = 51,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador","Graus de Liberdade Denominador","P-valor"))
```

A tabela acima é referente ao teste de ausência de regressão. Como o p-valor é menor que o nível de significância, há evidêcias estatísticas suficientes para dizer que há regressão neste modelo. 

Além disso temos as seguintes estatísticas:

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(data.frame("1" = c(0.4094),
                 "2" = c(51)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))
```

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(cbind(0.8153, 0.7972), col.names = c("$R^2$", "$R^2_{ajustado}$"))
```

\newpage

#### Verificação dos pressupostos


```{r  fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo1.trans, aes(modelo1.trans$fitted.values,modelo1.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo1, aes(X1,modelo1.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")

c <- ggplot(banco.modelo1, aes(sample = modelo1.trans$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()


grid.arrange(a,b,c,nrow=2,ncol=2)



```



Analisando os resíduos do modelo transformado, verificamos que a função de regressão é linear e as variâncias parecem ser homogêneas e independentes. Além disso, pelo gráfico qqnorm vemos que os resíduos estão normalmente distribuidos. Por fim, parece não haver omissão de variáveis explicativas importantes. Então para confirmar que a transformação resolveu o problema de homocedasticidade dos resíduos, serão feitos testes estatísticos apropriados.   
  

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo1.trans$residuals)
bp <- bptest(lm(log(banco.modelo1$Y)~xi1 + I(xi1^2)+banco.modelo1$X21+ banco.modelo1$X22+ banco.modelo1$X23))
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))
```


Com os resultados obtidos, contemplamos que a transformação não só resolveu o problema de homocedasticidade que tínhamos anteriormente, como também aumentou o p-valor do teste de normalidade.

### Seleção de variáveis

Para encontrar o modelo mais adequado, serão utilizados 2 métodos de seleção de variáveis: Eliminação backward manual e critério de seleção.


#### Eliminação backward manual

Após realizar várias etapas da elimicação backward manual, até que todas as variáveis fossem significativas, encontramos o seguinte modelo: 

$$\ln(Y)_{i} = \beta_{0} + \beta_{1} X_{i1} + \varepsilon_i$$

* $\ln(Y)_i$ representa o ln do número médio de enfermeiros(as) no hospital(i);
* $X_{i1}$ representa a porcentagem de 35 potenciais facilidades e serviços que são fornecidos pelo hospital(i).



```{r echo=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
modelo1.tbm <- lm(log(Y)~X1, data=banco.modelo1)
```


#### Critério de Seleção

Os critérios de seleção que iremos considerar são: BIC, CM, $R^2$ e $R^2_{ajustado}$

```{r fig.width = 6, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
selecao <- regsubsets(log(Y) ~ ., data = banco.modelo1, nbest = 5)

num.var <- as.numeric(rownames(summary(selecao)$which))

df <- data.frame(num.var, r2 = summary(selecao)$rsq, r2adj = summary(selecao)$adjr2, bic = summary(selecao)$bic, cm = summary(selecao)$cp)

a <- ggplot(df, aes(x=num.var, y=bic)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="BIC") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

b <- ggplot(df, aes(x=num.var, y=cm)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="CM") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)


c <- ggplot(df, aes(x=num.var, y=r2)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R²") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

d <- ggplot(df, aes(x=num.var, y= r2adj)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R² ajustado") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

grid.arrange(a,b,c,d,ncol=2)

```

Observando os gráficos acima, concluímos que os modelos utilizados serão 1 e 2 variáveis explicativas. Os candidatos são :

* Modelo com 1 variável

$$\ln(Y)_{i} = \beta_{0} + \beta_{1} X_{i1} + \varepsilon_i$$

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo11 <- lm(log(Y)~X1,data = banco.modelo1)
#summary(modelo11)
```

* Modelo com 2 variáveis

$$\ln(Y)_{i} = \beta_{0} + \beta_{1} X_{i1} + \beta_{22} X_{i22} + \varepsilon_i$$

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo12 <- lm(log(banco.modelo1$Y)~banco.modelo1$X1 + banco.modelo1$X22)
#summary(modelo12)
```



```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
mod11 <-  c( 0.8116140357,	0.80463678,	-83.018804,	1.65778088)
mod12 <-  c(	0.8103392395,	0.80689086,	-86.677439,	0.01411284)
df <- rbind(mod11,mod12)
kable(df, col.names = c("$R^2$","$R^2_{Ajustado}$","BIC","CM" ))
```

Percebe-se que o modelo com 1 variável é o mesmo obtido pela eliminação de backward manual. Como os valores dos critérios estão próximos nos 2 modelos, iremos utilizar o modelo com 1 variável explicativas como o modelo final.


### Modelo Final para a questão 1

Temos o seguinte modelo escolhido como candidato final:

$$\ln(Y)_{i} = \beta_{0} + \beta_{1} X_{i1} + \varepsilon_i$$
Agora vamos realizar análises para verificarmos a adequação do modelo.

####  Verificação de Pressupostos

Os itens a serem verificados são:

* Função de Regressão linear;
* Os erros do modelo tem variância constante;
* Os erros são independentes;
* Os erros são normalmente distribuidos.
* Não foram omitida variáveis explicativas importantes do modelo. 


```{r fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo11, aes(modelo11$fitted.values,modelo11$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo1, aes(X1,modelo11$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")


c <- ggplot(banco.modelo1, aes(sample = modelo11$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,ncol=2)


```


Analisando os gráficos parece que os pressupostos acerca dos resíduos estão sendo atendidos. realizando os testes adequados para confirmarmos a normalidade e homocedasticidade dos resíduos. 



```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo11$residuals)
bp <- bptest(lm(log(banco.modelo1$Y)~banco.modelo1$X1))


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"), row.names = F)
```


Com os resultados obtidos, temos evidências estatísticas suficientes para dizer que os resíduos são homogêneos e normalmente distribuidos.


#### Medidas influentes

Vamos verificar se o modelo é influênciado por alguma estimativa, utilizaremos as medidas $DFBETA$, $DFFIT$ e a Distância de Cook. Portanto:

```{r fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
medidas <- as.data.frame(influence.measures(modelo11)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X1)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - xi1")
 

 
grid.arrange(a, b, c, ncol = 2)
#banco.modelo22 <- banco.modelo1[-48,]
#summary(lm(log(banco.modelo22$Y) ~ xi1[-48]))
#banco.modelo22 <- banco.modelo1[-49,]
#summary(lm(log(banco.modelo22$Y) ~ xi1[-49]))

```

Através dos gráficos vemos que não há observações influentes no modelo, logo ele é robusto.

\newpage

### Validação do Modelo Final 1

Utilizaremos a outra metade do banco de dados(amostra2) para validar o modelo final. Para isso será empregado o Erro de Predição Quadrático Médio(MSPR) como critério de validação. Com isso temos a seguinte tabela:



```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

num.enf.chapeu <- predict(modelo11, banco.validacao1)
MSPR <- mean((log(banco.validacao1[,1]) - num.enf.chapeu)^2)
kable(cbind(anova(modelo11)["Residuals","Mean Sq"],MSPR), col.names = c("MSE", "MSPR"))
```


Como os valores do MSE e MSPR estão relativamente próximos, podemos dizer que o modelo final tem um bom poder preditivo.


### Estimação dos Parâmetros do Modelo Final 1

Temos os seguintes parâmetros estimados:

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
betas <- c("Beta_0","Beta_1")
kable(cbind(betas,summary(modelo11)[["coefficients"]]) ,col.names = c("Parâmetros","Estimativas","Erro Padrão","Estatística","P-valor"), row.names = F)
```

\newpage

## Modelo 2

Primeiramente vamos rodar o modelo com todas a variáveis do banco de dados para analisarmos os resíduos e verificarmos se é necessário uma transformação na variável Y.
$$Y_i = \beta_0 + \beta_1 X_{i1}  + \beta_2 X_{i2} +\beta_3 X_{i3}+\beta_4 X_{i4}+$$
$$+ \beta_5X_{i5}++\beta_6X_{i6}+\beta_9X_{i9}+\beta_{10}X_{i10}+\beta_{11}X_{i11}+\beta_{61} X_{i61}+\beta_{71} X_{i71}+\beta_{72} X_{i72} + \beta_{73} X_{i73}+  \epsilon_i$$
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
banco.mod <- amostra1

banco.mod$X7 <- as.character(banco.mod$X7)

a <- banco.mod$X7
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.mod$X61 <- as.factor(a) 


a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.mod$X71 <- as.factor(a)    

a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.mod$X72 <- as.factor(a)    

a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.mod$X73 <- as.factor(a) 

banco.mod <- banco.mod[,c(-1,-8,-9)]

mod <- lm(X1~X2+X3+X4+X5+X6+X9+X10+X11+X61+X71+X72+X73, data = banco.mod)



```


```{r fig.width = 6.5, fig.height = 2.7,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(mod, aes(mod$fitted.values,mod$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")

b <- ggplot(banco.mod, aes(sample = mod$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,ncol=2)

```


```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

#fazer tabela
s <- shapiro.test(mod$residuals)
bp <- bptest(mod)

teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(4.8763,0.98845)
 
pv <- c(0.962,0.8618)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))

kable(summary(mod)[["coefficients"]],col.names = c("Estimativas","Erro Padrão","Estatística","P-valor"))
```

Pela análise gráfica e testes realizados, os resíduos atendem os pressupostos de normalidade e homocedasticidade, logo não é necessário uma transformação na variável Y.

\newpage

### Modelo Completo

O modelo 2 completo tem a seguinte forma inicial:

$$Y_i = \beta_0 + \beta_1 X_{i1}  + \beta_2 X_{i2} +\beta_3 X_{i3}+\beta_4 X_{i4}+\beta_5 X_{i5}+\beta_{61} X_{i61}+\beta_{71} X_{i71}+\beta_{72} X_{i72} + \beta_{73} X_{i73}+  \epsilon_i$$

```{r echo=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
modelo2.completo <- lm(Y~X1+X2+X3+X4+X5+X61+X71+X72+X73,data=banco.modelo2)

```


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
df <- data.frame("Variável" = c("Intercepto", "X1", "X2", "X3", "X4", "X5", "X61", "X71", "X72", "X73"),
                 "Estimativas"= c(3.307, 0.0609, 0.4092, -0.0088, 0.0214, -0.0073, 0.3179, 1.4706, 0.7521, 0.2579),
                 "Erro Padrão"=c(2.0034,0.0348,0.1170,0.0046,0.0053,0.0027,0.5809,0.5042,0.4767,0.4704),
                 "Estatística" = c(1.663,1.751,3.497,-1.894,4.020,-2.674,0.547,2.917,1.578,0.548),
                 "P-valor" = c(0.1031,0.0865,0.0010,0.0644,0.0002,0.0103,0.5868,0.0054,0.1213,0.5861))
names(df) <- c("Variável","Estimativas","Erro Padrão","Estatística","P-valor")
kable(df)
```

Analisando a tabela acima, podemos ver que as variáveis $X_1,X_3,X_{61},X_{72},X_{73}$ não foram significativas para o modelo completo.

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
df <- data.frame(F = 14.16,
                 glnum = 9,
                 gldem = 47,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador","Graus de Liberdade Denominador","P-valor"))
```

A tabela acima é referente ao teste de ausência de regressão. Como o p-valor é menor que o nível de significância, há evidêcias estatísticas suficientes para dizer que há regressão neste modelo. 


```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(data.frame("1" = c(1.087),
                 "2" = c(47)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))
```

```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
kable(cbind(0.7306, 0.679), col.names = c("$R^2$", "$R^2_{ajustado}$"))
```

Com isso, temos que o erro padrão estimado para o modelo completo é 1.087, com 47 graus de liberdade. Note que esta é a estimativa para o $\sigma$. Já o $R^2_{ajustado}$ obtido foi 0.679, isso significa que as variáveis do modelo conseguem explicar quase 68% da duração média da internação do paciente.


\newpage

#### Verificação dos pressupostos

Os itens a serem verificados são:

* Função de Regressão linear;
* Os erros do modelo tem variância constante;
* Os erros são independentes;
* Os erros são normalmente distribuidos.
* Não foram omitida variáveis explicativas importantes do modelo. 


```{r  fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo2.completo, aes(modelo2.completo$fitted.values,modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo2, aes(X1,modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Idade")+
  ylab("Resíduos")

c <- ggplot(banco.modelo2, aes(X2,modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")


d <- ggplot(banco.modelo2, aes(X3,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número de leitos")+
ylab("Resíduos")


e <- ggplot(banco.modelo2, aes(X4,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
f <- ggplot(banco.modelo2, aes(X5,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

grid.arrange(a,b,c,d,e,f,ncol=3)


```

```{r  fig.width = 5, fig.height = 2.5,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
ggplot(banco.modelo2, aes(sample = modelo2.completo$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()
```

Analisando os resíduos do modelo verificamos que a função de regressão é linear e as variâncias parecem ser homogêneas e independentes. Além disso, pelo gráfico qqnorm vemos que os resíduos estão normalmente distribuidos. Por fim, parace não haver omissão de variáveis explicativas importantes. Então para confirmar a homogêneidade e a normalidade dos resíduos, serão feitos testes estatísticos apropriados.   



```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo2.completo$residuals)
bp <- bptest(Y~X1+X2+X3+X4+X5+X61+X71+X72+X73,data=banco.modelo2)
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(4.8412,0.99143)
 
pv <- c(0.8479,0.9581)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))
```


Com os resultados obtidos, temos evidências estatísticas suficientes para dizer que os resíduos são homogêneos e normalmente distribuidos.


### Seleção de variáveis

Para encontrar o modelo mais adequado, serão utilizados 2 métodos de seleção de variáveis: Eliminação backward manual e critério de seleção.


#### Eliminação backward manual

Após realizar várias etapas da elimicação backward manual, até que todas as variáveis fossem significativas, encontramos o seguinte modelo: 

$$Y_{i} = \beta_{0} + \beta_{2} X_{i2} + \beta_{3} X_{i3} + \beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71}$$


 
$$X_{i71} = \left\{\begin{matrix}
1\text{, se NE}\\ 0 \text{, caso contrário}
\end{matrix}\right.$$
 


* $Y_i$ representa a duração média da internação do paciente no hospital(i) (em dias);
* $X_{i2}$ é a probabilidade média do risco de infecção no hospital(i)(em porcentagem) (Variável $X3$ no banco);
* $X_{i3}$ indica o número médio de leitos do hospital(i)(Variável $X6$ no banco);
* $X_{i4}$ representa a média diária de pacientes do hospital(i)(Variável $X9$ no banco);
*  $X_{i5}$ representa o número médio de enfermeiros(as) do hospital(i)(Variável $X10$ no banco);

A variável Região ($X8$) por ser uma variável qualitativa foi dividida em apenas uma variável indicadora. Utilizando as regiões *W, NC e S* como referência, temos que:

* $X_{i71}$ indica que o hospital(i) se encontra na região *NE*.


```{r echo=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
modelo2.reduzido <- lm(Y~X2+X3+X4+X5+X71,data=banco.modelo2)

```

\newpage

#### Critério de Seleção

Os critérios de seleção que iremos considerar são: BIC, CM, $R^2$ e $R^2_{ajustado}$

```{r fig.width = 6, fig.height = 3,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
selecao <- regsubsets(Y ~ ., data = banco.modelo2, nbest = 8)

num.var <- as.numeric(rownames(summary(selecao)$which))

df <- data.frame(num.var, r2 = summary(selecao)$rsq, r2adj = summary(selecao)$adjr2, bic = summary(selecao)$bic, cm = summary(selecao)$cp)

a <- ggplot(df, aes(x=num.var, y=bic)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="BIC") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

b <- ggplot(df, aes(x=num.var, y=cm)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="CM") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)


c <- ggplot(df, aes(x=num.var, y=r2)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R²") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

d <- ggplot(df, aes(x=num.var, y= r2adj)) + geom_point(colour="darkslategray", size
=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R² ajustado") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

grid.arrange(a,b,c,d,ncol=2)

```



Observando os gráficos acima, concluímos que os modelos utilizados serão com 4, 5 e 6 variáveis explicativas. Os candidatos são :



* Modelo de 4 variáveis

$$Y_{i} = \beta_{0} + \beta_{2} X_{i2}  + \beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71} + \varepsilon_i$$

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo24 <- lm(Y~X2+X4+X5+X71,data=banco.modelo2)
#summary(modelo24)
```

* Modelo de 5 variáveis

$$Y_{i} = \beta_{0} + \beta_{2} X_{i2}  + \beta_{3} X_{i3} +\beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71} + \varepsilon_i$$

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo25 <- lm(Y~X2+X3+X4+X5+X71,data=banco.modelo2)
#summary(modelo25)
```

* Modelo de 6 variáveis

$$Y_{i} = \beta_{0}+ \beta_{1} X_{i1} + \beta_{2} X_{i2}  + \beta_{3} X_{i3} +\beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71} + \varepsilon_i$$

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo26 <- lm(Y~X1+X2+X3+X4+X5+X71,data=banco.modelo2)
#summary(modelo26)
```


```{r echo=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
mod1 <-  c(4, 0.6660346,	0.6403450,	-42.29767,	11.27045)
mod2 <-  c(5,	0.6949882,	0.6650851,	-43.42376,	8.218618)
mod3 <-  c(6,	0.7096083,	0.6747613,	-42.18055,	7.667686)
df <- rbind(mod1,mod2,mod3)
kable(df, col.names = c("Modelo","$R^2$","$R^2_{Ajustado}$","BIC","CM" ))
```

Percebe-se que o modelo com 5 variáveis é igual ao obtido pela eliminação de backward manual. Como os valores do $R^2,R^2_{Ajustado},BIC,CM$ estão próximos nos 3 modelos, iremos utilizar o modelo com 4 variáveis explicativas como o modelo final.

### Modelo Final para a questão 2

Temos o seguinte modelo escolhido como candidato final:

$$Y_{i} = \beta_{0} + \beta_{2} X_{i2}  + \beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71} + \varepsilon_i$$
Agora vamos realizar análises para verificarmos a adequação do modelo.

####  Verificação de Pressupostos

Os itens a serem verificados são:

* Função de Regressão linear;
* Os erros do modelo tem variância constante;
* Os erros são independentes;
* Os erros são normalmente distribuidos.
* Não foram omitida variáveis explicativas importantes do modelo. 


```{r fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo24, aes(modelo24$fitted.values,modelo24$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo2, aes(X2,modelo24$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")



c <- ggplot(banco.modelo2, aes(X4,modelo24$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
d <- ggplot(banco.modelo2, aes(X5,modelo24$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

e <- ggplot(banco.modelo2, aes(sample = modelo24$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,d,e,ncol=3)


```


Analisando os gráficos parece que os pressupostos acerca dos resíduos estão sendo atendidos. realizando os testes adequados para confirmarmos a normalidade e homocedasticidade dos resíduos. 



```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo24$residuals)
bp <- bptest(Y~X2+X4+X5+X71,data=banco.modelo2)


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"), row.names = F)
```


Com os resultados obtidos, temos evidências estatísticas suficientes para dizer que os resíduos são homogêneos e normalmente distribuidos.

\newpage

#### Multicolinearidade

Calculando o Fator de Inflação de Variância (VIF):


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
vi<-vif(modelo24)
kable(vi, col.names = "VIF")
```

Analisando os valores do VIF vemos que parece haver uma certa multicolinearidade no modelo, porém como o maior valor é menor que 10, não chega a ser um problema para o modelo.

#### Medidas influentes

Conforme visto anteriormente, existe um valor no banco de dados que parece influenciar no modelo. Para tal, utilizaremos as medidas $DFBETA$, $DFFIT$ e a Distância de Cook. Portanto:

```{r fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
medidas <- as.data.frame(influence.measures(modelo24)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X2)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Risco de Infecção")
 
d <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X4)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Média Diária de Pacientes")
 
e <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X5)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Número de Enfermeiros")
 
f <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X711)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Região NE")
 
grid.arrange(a, b, c, d, e, f, ncol = 3)

#summary(lm(Y ~ X2+X4+X5+X71, data = banco.modelo2))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-56,]))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-28,]))
```

Através dos gráficos, podemos identificar que:

* Índice 56 influencia nas variáveis média diárias de pacientes e número de enfermeiros(as),e também vemos pelo DFFIT que o mesmo índice influência no modelo,visto que há uma redução no $R^2$ e $R^2_{ajustado}$ no modelo quando a observação é removida.

Logo, podemos afirmar que o modelo não é robusto, já que ele é sensível à medidas influentes.

\newpage

### Validação Modelo Final 2


Utilizaremos a outra metade do banco de dados(amostra2) para validar o modelo final. Para isso será empregado o Erro de Predição Quadrático Médio(MSPR) como critério de validação. Com isso temos a seguinte tabela:





```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

num.enf.chapeu <- predict(modelo24, banco.validacao2)
MSPR <- mean((banco.validacao2[,1] - num.enf.chapeu)^2)
kable(cbind(anova(modelo24)["Residuals","Mean Sq"],MSPR), col.names = c("MSE", "MSPR"))
```

Como os valores do MSE e MSPR não estão próximos, vamos aplicar uma transformação no modelo final para que ele tenha um bom poder preditivo.


### Modelo Final Transformado para a questão 2



Aplicando a transformação logarítmica na variável Y, temos o seguinte modelo transformado:

$$\ln(Y)_{i} = \beta_{0} + \beta_{2} X_{i2}  + \beta_{4} X_{i4} + \beta_{5} X_{i5} + \beta_{71} X_{i71} + \varepsilon_i$$
Agora vamos realizar análises para verificarmos a adequação do modelo.

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
modelo24.trans <- lm(log(Y)~X2+X4+X5+X71,data=banco.modelo2)
```

####  Verificação de Pressupostos



```{r fig.width = 6.5, fig.height = 4,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
a <- ggplot(modelo24.trans, aes(modelo24.trans$fitted.values,modelo24.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo2, aes(X2,modelo24.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")



c <- ggplot(banco.modelo2, aes(X4,modelo24.trans$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
d <- ggplot(banco.modelo2, aes(X5,modelo24.trans$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

e <- ggplot(banco.modelo2, aes(sample = modelo24.trans$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,d,e,ncol=3)


```


Analisando os gráficos parece que os pressupostos acerca dos resíduos estão sendo atendidos. realizando os testes adequados para confirmarmos a normalidade e homocedasticidade dos resíduos. 



```{r  message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
s <- shapiro.test(modelo24.trans$residuals)
bp <- bptest(log(Y)~X2+X4+X5+X71,data=banco.modelo2)


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"), row.names = F)
```


Com os resultados obtidos, temos evidências estatísticas suficientes para dizer que os resíduos são homogêneos e normalmente distribuidos.



#### Multicolinearidade

Calculando o Fator de Inflação de Variância (VIF):


```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
vi<-vif(modelo24.trans)
kable(vi, col.names = "VIF")
```

Analisando os valores do VIF vemos que parece haver uma certa multicolinearidade no modelo, porém como o maior valor é menor que 10, não chega a ser um problema para o modelo.

#### Medidas influentes

Utilizando as medidas $DFBETA$, $DFFIT$ e a Distância de Cook para vermos se há valores extremos que influenciam no modelo. Temos que:

```{r fig.width = 6.5, fig.height = 3.5,fig.align='center', message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
medidas <- as.data.frame(influence.measures(modelo24.trans)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X2)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Risco de Infecção")
 
d <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X4)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Média Diária de Pacientes")
 
e <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X5)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Número de Enfermeiros")
 
f <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X711)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Região NE")
 
grid.arrange(a, b, c, d, e, f, ncol = 3)

#summary(lm(Y ~ X2+X4+X5+X71, data = banco.modelo2))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-56,]))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-28,]))
```

Conforme visto nos gráficos acima, não temos observações influentes no modelo, visto que nenhuma das medidas teve valor maior que 1, ou seja, o modelo transformado é robusto.

\newpage

### Validação do Modelo Final 2 Transformado  


Utilizaremos a outra metade do banco de dados(amostra2) para validar o modelo final transformado. Para isso será empregado o Erro de Predição Quadrático Médio(MSPR) como critério de validação. Com isso temos a seguinte tabela:



```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}

num.enf.chapeu <- predict(modelo24.trans, banco.validacao2)
MSPR <- mean((log(banco.validacao2[,1]) - num.enf.chapeu)^2)
kable(cbind(anova(modelo24.trans)["Residuals","Mean Sq"],MSPR), col.names = c("MSE", "MSPR"))
```

Como os valores do MSE e MSPR estão muito próximos, podemos afirmar que o modelo final transformado tem um bom poder preditivo.


### Estimação dos Parâmetros do Modelo Final 2 Transformado

Temos os seguintes parâmetros estimados:

```{r message=FALSE, warning=FALSE, paged.print=FALSE, echo=F}
betas <- c("Beta_0","Beta_2","Beta_4","Beta_5","Beta_71")
kable(cbind(betas,summary(modelo24.trans)[["coefficients"]]) ,col.names = c("Parâmetros","Estimativas","Erro Padrão","Estatística","P-valor"), row.names = F)
```

\newpage

# Considerações Finais

## Interpretação do Modelo 1

Conforme visto na seção de Resultados, o modelo final relativo à **Questão 1** do pesquisador tem a seguinte forma:

$$\ln(Y)_{i} = 2.7701 + 0.0486 X_{i1} + \varepsilon_{i}$$

Sendo assim, temos as seguinte observações:

* Quando a porcentagem de serviços prestado pelo hospital é zero, espera-se que o logaritmo do número de enfermeiros seja entre 2 a 3. Contudo, temos que pensar que é um pouco estranho o hospital estar com todos os seus serviços e instalações parados (salvo casos de tragédia, como incêndios, falta de luz, etc); portanto, acreditamos não fazer tanto sentido interpretar o intercepto isoladamente.

* É esperado um incremento de 0.0486 no logaritmo do número de enfermeiros para cada incremento de porcentagem de serviços do hospital. Considerando que para o hospital prestar mais serviços é necessário também ter mais mão de obra, esse incremento faz sentido.

* O modelo cumpriu as suposições de normalidade e homogeneidade; além disso, ele não apresentou medidas influentes, portanto, ele é robusto.

* O modelo final foi validado com a amostra 2, sendo assim, ele apresenta um bom poder preditivo.

Em relação ao modelo inicial $Y_i=\beta_0+\beta_1 x_{i1}+\beta_{11}x^2_{i1}+\beta_{21} X_{i21}+\beta_{22} X_{i22}+\beta_{23} X_{i23}$, temos as seguintes diferenças:

* Contrariando o que o pesquisador inicialmente imaginava, nenhuma das regiões são significativas para explicar o número de enfermeiros. Sendo assim, todas as variáveis relacionadas à região foram excluídas do modelo final.

* Ao contrário do que o pesquisador imaginou e do que a análise exploratória apontou, não foi necessário a implementação de um modelo de segunda ordem. Dessa forma, o modelo final foi simplificado para um modelo de regressão linear simples.

* Devido à falta de homogeneidade, foi preciso realizar uma transformação logarítmica na variável resposta, corrigindo o problema.


## Interpretação do Modelo 2

O modelo final para a **Questão 2** teve a seguinte forma:

$$\ln(Y)_{i} = 1.9595 + 0.425 X_{i2} + 0.0011 X_{i4} - 0.0008 X_{i5} + 0.1286 X_{i71}$$

Logo, temos as seguintes interpretações:

* Quando todas as variáveis assumem valor zero, o valor esperado do logaritmo de duração de internação de hospital é 1.9595. Nesse caso, há duas intepretações: A primeira é que não faz sentido pensar que alguém possa ser internado quando não há nenhum enfermeiro no hospital, logo não deveríamos pensar no intercepto sozinho; a segunda interpretação é que isso é a média de um número mínimo de tempo que o paciente deve ficar internado no hospital, determinado por uma regra e independente de qualquer outro fator.

* Espera-se que para cada incremento na probabilidade média do risco de infecção, o logaritmo da duração da internação aumente em 0.0425; isso faz sentido, pois se o paciente tem mais risco de infecção, mais tempo ele precisará continuar no hospital.

* Para cada aumento unitário na média de pacientes do hospital, esperamos que aumente o logaritmo da média de internação em 0.0011. Seguindo a lógica de que quanto mais pacientes, maior a probabilidade de um deles precisar ficar mais tempo internado e com isso aumentar a média de internação, o modelo parece representar a realidade.

* É esperado que para cada acréscimo no número de enfermeiros, a duração de internação média seja diminuida em 0.0008. Sendo assim, podemos pensar que embora seja um efeito mínimo, uma maior quantidade de enfermeiros ajuda um paciente a se recuperar mais rapidamente.

* Caso o hospital se encontre na região "NE", espera-se que ele fique 0.1286 de tempo a mais do que se ele fosse pra um hospital de outra região. Isso pode ser explicado de duas formas: a primeira é que essa região é mais pobre do que as demais, prestando então um serviço de menor qualidade e que leva mais tempo para o paciente se recuperar; a segunda interpretação é que nessa região existe uma maior concentração de hospitais especializados em casos graves e que necessitam de maior tempo de internação, e por isso a diferença dentre as outras regiões.

Comparando o modelo final com o modelo inicial $Y_i = \beta_0 + \beta_1 X_{i1}  + \beta_2 X_{i2} +\beta_3 X_{i3}+\beta_4 X_{i4}+\beta_5 X_{i5}+\beta_{61} X_{i61}+\beta_{71} X_{i71}+\beta_{72} X_{i72} + \beta_{73} X_{i73}+  \epsilon_i$, podemos observar que:

* Contrariando o senso comum, a idade de uma pessoa não é significante para o tempo da internação; talvez isso sugira que o importante é a condição e a saúde que o paciente se encontra, e não a idade propriamente dita. Dessa forma, a variável "Idade" foi removida do modelo.

* O número de leitos que um hospital possui não afeta significativamente a duração da internação dos seus pacientes. Então, a respectiva variável também foi removida pro modelo final.

* As variáveis indicadoras relativas às regiões "NC" e "S" não foram diferentes o suficiente da região de referência "W" e, portanto, foram removidas do modelo. Contudo, a região "NE" é diferente das demais, e sua variável permaneceu no modelo final.

* Embora o modelo atendesse às necessidades de normalidade e homogeneidade, foi detectada a presença de um valor influente no modelo. Sendo assim, foi aplicada a transformação logarítmica no modelo, o que corrigiu o problema e tornou o modelo robusto.


\newpage

# Códigos utilizados

\fontsize{10pt}{15pt}\selectfont

```{r eval=F}
# Carregamento dos pacotes
library(pacman)
pacman:::p_load("tidyverse", "gridExtra", "knitr","openxlsx","readr","lmtest","leaps",
                "car")

# Importação dos dados
setwd("C:/Users/bruno/Desktop/5 Semestre/Regressão/Remoto/Trabalho/pqp/Modelo rMarkdown")
dados <-  readxl::read_xlsx("Dados_trabalho_20201_.xlsx")
amostra1 <- readr::read_rds("amostra1.xls")
amostra2 <- readr::read_rds("amostra2.xls")

# Transformação das variáveis qualitativas
dados$X7 <- as.factor(dados$X7)
dados$X8 <- as.factor(dados$X8)
amostra1$X7 <- as.factor(amostra1$X7)
amostra1$X8 <- as.factor(amostra1$X8)
amostra2$X7 <- as.factor(amostra2$X7)
amostra2$X8 <- as.factor(amostra2$X8)

dados1 <- dados %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))

amostra1 <- amostra1 %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))

amostra2 <- amostra2 %>% 
  mutate(X7 = fct_recode(X7,
                   "Sim" = "1",
                   "Não" = "2"),
         X8 = fct_recode(X8,
                     "NE" = "1",
                     "NC" = "2",
                     "S" = "3",
                     "W" = "4"))


# Banco modelo 1 - Amostra 1
banco.modelo1 <- amostra1 %>% 
  select(X10,X11,X8)


names(banco.modelo1) <- c("Y","X1","X2")
banco.modelo1$X2 <- as.character(banco.modelo1$X2)

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.modelo1$X21 <- as.numeric(a)    

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.modelo1$X22 <- as.numeric(a)    

a <- banco.modelo1$X2
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.modelo1$X23 <- as.numeric(a) 

banco.modelo1 <- banco.modelo1[,-3]

# Banco modelo 1 - Amostra 2 de Validação
banco.validacao1 <- amostra2 %>% 
  select(X10,X11,X8)


names(banco.validacao1) <- c("Y","X1","X2")
banco.validacao1$X2 <- as.character(banco.validacao1$X2)

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.validacao1$X21 <- as.numeric(a)    

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.validacao1$X22 <- as.numeric(a)    

a <- banco.validacao1$X2
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.validacao1$X23 <- as.numeric(a) 

banco.validacao1 <- banco.validacao1[,-3]

# Banco modelo 2 - Amostra 1
banco.modelo2 <- amostra1 %>% 
  select(X1,X2,X3,X6,X9,X10,X7,X8)

names(banco.modelo2) <- c("Y","X1","X2","X3","X4","X5","X6","X7")
banco.modelo2$X7 <- as.character(banco.modelo2$X7)

a <- banco.modelo2$X6
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.modelo2$X61 <- as.factor(a) 


a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.modelo2$X71 <- as.factor(a)    

a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.modelo2$X72 <- as.factor(a)    

a <- banco.modelo2$X7
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.modelo2$X73 <- as.factor(a) 

banco.modelo2 <- banco.modelo2[,c(-7,-8)]


# Banco modelo 2 - Validação
banco.validacao2 <- amostra2 %>% 
  select(X1,X2,X3,X6,X9,X10,X7,X8)

names(banco.validacao2) <- c("Y","X1","X2","X3","X4","X5","X6","X7")
banco.validacao2$X7 <- as.character(banco.validacao2$X7)

a <- banco.validacao2$X6
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.validacao2$X61 <- as.factor(a) 


a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.validacao2$X71 <- as.factor(a)    

a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.validacao2$X72 <- as.factor(a)    

a <- banco.validacao2$X7
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.validacao2$X73 <- as.factor(a) 

banco.validacao2 <- banco.validacao2[,c(-7,-8)]


# Tabela Introdução
codigo <- c("ID","X1","X2","X3","X4","X5","X6","X7","X8","X9","X10","X11")
nome <- c("Número de Identificação","Duração da Internação","Idade","Risco 
          de Infecção","Proporção de Culturas de Rotina","Proporção de Raio-X 
          de Tórax de Rotina","Número de leitos","Filiação a Escola de 
          Medicina","Região","Média diária de pacientes","Número de 
          enfermeiro(s) ","Facilidades e serviços disponíveis")

descricao <- c("1-113","Duração média da internação de todos os pacientes no 
hospital (em dias)","Idade média dos pacientes","Probabilidade média estimada 
               de adquirir infecção no hospital (em %)","Razão do número de
               culturas realizadas com relação ao número de pacientes sem 
               sinais ou sintomas de infeção adquirida no hospital, 
               vezes 100.","Razão do número de Raio-X de Tórax realizados com
               relação ao número
               de pacientes sem sinais ou sintomas de pneumonia, vezes 100."
               ,"Número médio de leitos no hospital durante o período de 
               estudo","1 – sim 2 – não","Região Geográfica, onde:
               1 – NE 2- NC 3 – S e 4 – W","Número médio de pacientes 
               no hospital por dia durante o período do estudo","Número
               médio de enfermeiros(as) de tempo-integral ou equivalente
               registrados e licenciados durante o período de estudo 
               ( número de tempos integrais+metade do número de tempo
               parcial)","% de 35 potenciais facilidades e serviços que são 
               fornecidos pelo hospital")

table <- data.frame(codigo,nome,descricao)
kable(table, col.names = c("Código       ","   Nome   ","Descrição"))

# Tabela Metodologia teste F - ANOVA
kable(cbind(
  c("Regressão", "Resíduo", "Total"),
  c("SQReg", "SQRes", "SQTotal"),
  c("p", "n - (p+1)", "n - 1"),
  c("QMReg", "QMRes", ""),
  c("QMReg/QMRes", "", "")
), col.names = c("Fonte de Variação", "SQ", "G.L.", "QM", "F"))


#Análise Descritiva
## Univariada

### Variável X1 - Duração da Internação

#### Tabela de medidas

meanX1 = mean(dados$X1)
medianX1= median(dados$X1)
q1X1 = quantile(dados$X1, names=FALSE)[2]
q2X1 = quantile(dados$X1, names=FALSE)[3]
q3X1 = quantile(dados$X1, names=FALSE)[4]
q4X1 = quantile(dados$X1, names=FALSE)[5]
maxX1 = max(dados$X1)
minX1 = min(dados$X1)

varX1 = var(dados$X1)
sdX1 = sd(dados$X1)

d1X1 = quantile(dados$X1, seq(0, 1, 0.1), names=FALSE)[2]
d9X1 = quantile(dados$X1, seq(0, 1, 0.1), names=FALSE)[10]

skewX1 = 3*(meanX1 - medianX1)/sdX1
kurtX1 = (q3X1 - q1X1)/(2*(d9X1 - d1X1))
coef.varX1 = (sdX1/meanX1)*100

mX1 <- c(round(c(meanX1,minX1,q1X1,medianX1,q3X1,maxX1,varX1,sdX1,
                 skewX1,kurtX1,coef.varX1),2))
nX1 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose",
         "Coeficiente de Variação(%)")
variX1 <- data.frame(Medidas = nX1, Valores = mX1)
kable(variX1,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X1,breaks = seq(6,24,4)))
kable(freq_salarios,col.names = c("Duração da Internação","Frequência"),
      caption = "Distribuição de frequência para Duração de Internação")

#### Histograma

graf11 <- ggplot(dados,aes(x=X1))+
  geom_histogram(colour="white",fill="darkslategray",binwidth=1)+
  labs(x="Duração da Internação", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black"))

#### Boxplot
graf12 <- ggplot(dados,aes(x=factor(""), y=X1))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Duração da Internação")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))

grid.arrange(graf11, graf12,ncol=2)

#### Gráfico de probabilidade normal
ggplot(dados, aes(sample = X1)) +
  stat_qq(colour = "darkslategray") +
  labs(x="",y="Duração da Internação")+
  stat_qq_line()+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=12),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))

#### Teste de normalidade - Shapiro Wilk

shapiro.test(dados$X1)


### Variável X2 - Idade

#### Tabela de medidas

meanX2 = mean(dados$X2)
medianX2= median(dados$X2)
q1X2 = quantile(dados$X2, names=FALSE)[2]
q2X2 = quantile(dados$X2, names=FALSE)[3]
q3X2 = quantile(dados$X2, names=FALSE)[4]
q4X2 = quantile(dados$X2, names=FALSE)[5]
maxX2 = max(dados$X2)
minX2 = min(dados$X2)

varX2 = var(dados$X2)
sdX2 = sd(dados$X2)

d1X2 = quantile(dados$X2, seq(0, 1, 0.1), names=FALSE)[2]
d9X2 = quantile(dados$X2, seq(0, 1, 0.1), names=FALSE)[10]

skewX2 = 3*(meanX2 - medianX2)/sdX2
kurtX2 = (q3X2 - q1X2)/(2*(d9X2 - d1X2))
coef.varX2 = (sdX2/meanX2)*100

mX2 <- c(round(c(meanX2,minX2,q1X2,medianX2,q3X2,maxX2,varX2,
                 sdX2,skewX2,kurtX2,coef.varX2),2))
nX2 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose",
         "Coeficiente de Variação(%)")
variX2 <- data.frame(Medidas = nX2, Valores = mX2)
kable(variX2,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X2,breaks = seq(35,70,7)))
kable(freq_salarios,col.names = c("Idade","Frequência"),
      caption = "Distribuição de frequência para Idade")

#### Histograma

graf21 <- (ggplot(dados,aes(x=X2))+
             geom_histogram(colour="white",fill="darkslategray",
                            binwidth=5)+
  labs(x="Idade", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))

#### Boxplot
graf22 <- (ggplot(dados,aes(x=factor(""), y=X2))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Idade")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf21, graf22,ncol=2)

### Variável X3 - Risco de Infecção

#### Tabela de medidas

meanX3 = mean(dados$X3)
medianX3= median(dados$X3)
q1X3 = quantile(dados$X3, names=FALSE)[2]
q2X3 = quantile(dados$X3, names=FALSE)[3]
q3X3 = quantile(dados$X3, names=FALSE)[4]
q4X3 = quantile(dados$X3, names=FALSE)[5]
maxX3 = max(dados$X3)
minX3 = min(dados$X3)

varX3 = var(dados$X3)
sdX3 = sd(dados$X3)

d1X3 = quantile(dados$X3, seq(0, 1, 0.1), names=FALSE)[2]
d9X3 = quantile(dados$X3, seq(0, 1, 0.1), names=FALSE)[10]

skewX3 = 3*(meanX3 - medianX3)/sdX3
kurtX3 = (q3X3 - q1X3)/(2*(d9X3 - d1X3))
coef.varX3 = (sdX3/meanX3)*100

mX3 <- c(round(c(meanX3,minX3,q1X3,medianX3,q3X3,maxX3,
                 varX3,sdX3,skewX3,kurtX3,coef.varX3),2))
nX3 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose","Coeficiente de Variação(%)")
variX3 <- data.frame(Medidas = nX3, Valores = mX3)
kable(variX3,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X3,breaks = seq(1,10,2)))
kable(freq_salarios,col.names = c("Risco de Infecção","Frequência"),
      caption = "Distribuição de frequência para Risco de Infecção")

#### Histograma

graf31 <- (ggplot(dados,aes(x=X3))+
             geom_histogram(colour="white",fill="darkslategray",binwidth=1)+
  labs(x="Risco de Infecção", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))

#### Boxplot
graf32 <- (ggplot(dados,aes(x=factor(""), y=X3))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Risco de Infecção")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf31, graf32,ncol=2)

### Variável X4 - Proporção de Culturas de Rotina

#### Tabela de medidas

meanX4 = mean(dados$X4)
medianX4= median(dados$X4)
q1X4 = quantile(dados$X4, names=FALSE)[2]
q2X4 = quantile(dados$X4, names=FALSE)[3]
q3X4 = quantile(dados$X4, names=FALSE)[4]
q4X4 = quantile(dados$X4, names=FALSE)[5]
maxX4 = max(dados$X4)
minX4 = min(dados$X4)

varX4 = var(dados$X4)
sdX4 = sd(dados$X4)

d1X4 = quantile(dados$X4, seq(0, 1, 0.1), names=FALSE)[2]
d9X4 = quantile(dados$X4, seq(0, 1, 0.1), names=FALSE)[10]

skewX4 = 3*(meanX4 - medianX4)/sdX4
kurtX4 = (q3X4 - q1X4)/(2*(d9X4 - d1X4))
coef.varX4 = (sdX4/meanX4)*100

mX4 <- c(round(c(meanX4,minX4,q1X4,medianX4,q3X4,maxX4,
                 varX4,sdX4,skewX4,kurtX4,coef.varX4),2))
nX4 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose",
         "Coeficiente de Variação(%)")
variX4 <- data.frame(Medidas = nX4, Valores = mX4)
kable(variX4,caption = "Medidas de posição, variabilidade,
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X4,breaks = seq(1,70,10)))
kable(freq_salarios,col.names = c("Proporção de 
                                  Culturas de Rotina","Frequência"),
      caption = "Distribuição de frequência para Risco da 
      Proporção de Culturas de Rotina")

#### Histograma

graf41 <- (ggplot(dados,aes(x=X4))+
             geom_histogram(colour="white",fill="darkslategray",binwidth=5)+
  labs(x="Proporção de Culturas de Rotina", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))

#### Boxplot
graf42 <- (ggplot(dados,aes(x=factor(""), y=X4))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de Culturas de Rotina")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf41, graf42,ncol=2)

### Variável X5 - Proporção de Raio - X de Tórax de Rotina

#### Tabela de medidas

meanX5 = mean(dados$X5)
medianX5= median(dados$X5)
q1X5 = quantile(dados$X5, names=FALSE)[2]
q2X5 = quantile(dados$X5, names=FALSE)[3]
q3X5 = quantile(dados$X5, names=FALSE)[4]
q4X5 = quantile(dados$X5, names=FALSE)[5]
maxX5 = max(dados$X5)
minX5 = min(dados$X5)

varX5 = var(dados$X5)
sdX5 = sd(dados$X5)

d1X5 = quantile(dados$X5, seq(0, 1, 0.1), names=FALSE)[2]
d9X5 = quantile(dados$X5, seq(0, 1, 0.1), names=FALSE)[10]

skewX5 = 3*(meanX5 - medianX5)/sdX5
kurtX5 = (q3X5 - q1X5)/(2*(d9X5 - d1X5))
coef.varX5 = (sdX5/meanX5)*100

mX5 <- c(round(c(meanX5,minX5,q1X5,medianX5,q3X5,maxX5,
                 varX5,sdX5,skewX5,kurtX5,coef.varX5),2))
nX5 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria",
         "Curtose","Coeficiente de Variação(%)")
variX5 <- data.frame(Medidas = nX5, Valores = mX5)
kable(variX5,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X5,breaks = seq(35,140,15)))
kable(freq_salarios,
      col.names = c("Proporção de Raio - X de Tórax de Rotina",
                    "Frequência"),
      caption = "Distribuição de frequência para Proporção de Raio - X 
      de Tórax de Rotina")

#### Histograma

graf51 <- (ggplot(dados,aes(x=X5))+
             geom_histogram(colour="white",fill="darkslategray",binwidth=14)+
  labs(x="Proporção de Raio - X de Tórax de Rotina", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


#### Boxplot
graf52 <- (ggplot(dados,aes(x=factor(""), y=X5))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de Raio - X de Tórax de Rotina")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf51, graf52,ncol=2)


### Variável X6 - Número de leitos

#### Tabela de medidas

meanX6 = mean(dados$X6)
medianX6= median(dados$X6)
q1X6 = quantile(dados$X6, names=FALSE)[2]
q2X6 = quantile(dados$X6, names=FALSE)[3]
q3X6 = quantile(dados$X6, names=FALSE)[4]
q4X6 = quantile(dados$X6, names=FALSE)[5]
maxX6 = max(dados$X6)
minX6 = min(dados$X6)

varX6 = var(dados$X6)
sdX6 = sd(dados$X6)

d1X6 = quantile(dados$X6, seq(0, 1, 0.1), names=FALSE)[2]
d9X6 = quantile(dados$X6, seq(0, 1, 0.1), names=FALSE)[10]

skewX6 = 3*(meanX6 - medianX6)/sdX6
kurtX6 = (q3X6 - q1X6)/(2*(d9X6 - d1X6))
coef.varX6 = (sdX6/meanX6)*100

mX6 <- c(round(c(meanX6,minX6,q1X6,medianX6,q3X6,maxX6,
                 varX6,sdX6,skewX6,kurtX6,coef.varX6),2))
nX6 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose",
         "Coeficiente de Variação(%)")
variX6 <- data.frame(Medidas = nX6, Valores = mX6)
kable(variX6,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X6,breaks = seq(25,900,125)))
kable(freq_salarios,col.names = c("Proporção de Número de leitos",
                                  "Frequência"),
      caption = "Distribuição de frequência para número de leitos")

#### Histograma

graf61 <- (ggplot(dados,aes(x=X6))+
             geom_histogram(colour="white",
                            fill="darkslategray",binwidth=80)+
  labs(x="Proporção de número de leitos", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


#### Boxplot
graf62 <- (ggplot(dados,aes(x=factor(""), y=X6))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de número de leitos")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf61, graf62,ncol=2)

### Variável X7 - Filiação a Escola de Medicina

#### Tabela de frequência

freq1 <- sum(dados1$X7 == "Sim")
freq2 <- sum(dados1$X7 == "Não")
perc1 <- round(freq1/length(dados1$X7),2)
perc2 <- round(freq2/length(dados1$X7),2)

freq.X7 <- c(freq1,freq2)
porc.X7 <- c(perc1,perc2)
x7 <- c("Sim", "Não")
tabelax7 <- data.frame(x7,freq.X7,porc.X7)
kable(tabelax7, col.names = c("X7", "Frequência","Porcentagem"))

#### Gráfico de Barras 
ggplot(dados1, aes(x = X7)) + 
  geom_bar( fill=c("#69d171","#d96464")) + 
  labs(x="Filiação a Escola de Medicina" , y="Frequência") + 
  theme_bw() +
  theme( axis.title.y=element_text(colour="black" , size=12) , 
         axis.title.x = element_text(colour="black" , size=12) , 
         axis.text = element_text(colour = "black" , size=9.5) , 
         panel.border = element_blank () , 
         axis.line = element_line(colour = "black"),
         plot.title = element_text(size=12,hjust=0.3,
                                   colour="black"))

### Variável X8 - Região

#### Tabela de frequência

freq11 <- sum(dados1$X8 == "NE");perc11 <- round(freq11/length(dados1$X8),2)
freq22 <- sum(dados1$X8 == "NC");perc22 <- round(freq22/length(dados1$X8),2)
freq33 <- sum(dados1$X8 == "S");perc33 <- round(freq33/length(dados1$X8),2)
freq44 <- sum(dados1$X8 == "W");perc44 <- round(freq44/length(dados1$X8),2)


freq.X8 <- c(freq11,freq22,freq33,freq44)
porc.X8 <- c(perc11,perc22,perc33,perc44)
x8 <- c("NE", "NC","S","W")
tabelax8 <- data.frame(x8,freq.X8,porc.X8)

kable(tabelax8, col.names = c("X8", "Frequência","Porcentagem"))

#### Gráfico de Barras 
ggplot(dados1, aes(x = X8)) + 
  geom_bar( fill=c("#69d171","#d96464","#99aae8","#d09ff5")) + 
  labs(x="Região" , y="Frequência") + 
  theme_bw() +
  theme( axis.title.y=element_text(colour="black" , size=12) , 
         axis.title.x = element_text(colour="black" , size=12) , 
         axis.text = element_text(colour = "black" , size=9.5) , 
         panel.border = element_blank () , 
         axis.line = element_line(colour = "black"),
         plot.title = element_text(size=12,hjust=0.3,
                                   colour="black"))

### Variável X9 - Média diárias de pacientes

#### Tabela de medidas

meanX9 = mean(dados$X9)
medianX9= median(dados$X9)
q1X9 = quantile(dados$X9, names=FALSE)[2]
q2X9 = quantile(dados$X9, names=FALSE)[3]
q3X9 = quantile(dados$X9, names=FALSE)[4]
q4X9 = quantile(dados$X9, names=FALSE)[5]
maxX9 = max(dados$X9)
minX9 = min(dados$X9)

varX9 = var(dados$X9)
sdX9 = sd(dados$X9)

d1X9 = quantile(dados$X9, seq(0, 1, 0.1), names=FALSE)[2]
d9X9 = quantile(dados$X9, seq(0, 1, 0.1), names=FALSE)[10]

skewX9 = 3*(meanX9 - medianX9)/sdX9
kurtX9 = (q3X9 - q1X9)/(2*(d9X9 - d1X9))
coef.varX9 = (sdX9/meanX9)*100

mX9 <- c(round(c(meanX9,minX9,q1X9,medianX9,q3X9,maxX9,
                 varX9,sdX9,skewX9,kurtX9,coef.varX9),2))
nX9 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
         "Variância","Desvio Padrão","Assimetria","Curtose",
         "Coeficiente de Variação(%)")
variX9 <- data.frame(Medidas = nX9, Valores = mX9)
kable(variX9,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X9,breaks = seq(20,820,100)))
kable(freq_salarios,col.names = c("Proporção de Média diárias 
                                  de pacientes","Frequência"),
      caption = "Distribuição de frequência para média diárias
      de pacientes")

#### Histograma

graf91 <- (ggplot(dados,aes(x=X9))+
             geom_histogram(colour="white",fill="darkslategray",binwidth=100)+
  labs(x="Proporção de média diárias de pacientes", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


#### Boxplot
graf92 <- (ggplot(dados,aes(x=factor(""), y=X9))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de média diárias de pacientes")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf91, graf92,ncol=2)

### Variável X10 - Número de enfermeiro(s)

#### Tabela de medidas

meanX10 = mean(dados$X10)
medianX10= median(dados$X10)
q1X10 = quantile(dados$X10, names=FALSE)[2]
q2X10 = quantile(dados$X10, names=FALSE)[3]
q3X10 = quantile(dados$X10, names=FALSE)[4]
q4X10 = quantile(dados$X10, names=FALSE)[5]
maxX10 = max(dados$X10)
minX10 = min(dados$X10)

varX10 = var(dados$X10)
sdX10 = sd(dados$X10)

d1X10 = quantile(dados$X10, seq(0, 1, 0.1), names=FALSE)[2]
d9X10 = quantile(dados$X10, seq(0, 1, 0.1), names=FALSE)[10]

skewX10 = 3*(meanX10 - medianX10)/sdX10
kurtX10 = (q3X10 - q1X10)/(2*(d9X10 - d1X10))
coef.varX10 = (sdX10/meanX10)*100

mX10 <- c(round(c(meanX10,minX10,q1X10,medianX10,q3X10,maxX10,
                  varX10,sdX10,skewX10,kurtX10,coef.varX10),2))
nX10 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
          "Variância","Desvio Padrão","Assimetria","Curtose",
          "Coeficiente de Variação(%)")
variX10 <- data.frame(Medidas = nX10, Valores = mX10)
kable(variX10,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X10,breaks = seq(10,710,100)))
kable(freq_salarios,col.names = c("Proporção de Número de 
                                  enfermeiro(s)","Frequência"),
      caption = "Distribuição de frequência para número de enfermeiro(s)")
#### Histograma

graf101 <- (ggplot(dados,aes(x=X10))+
              geom_histogram(colour="white",fill="darkslategray",
                             binwidth=100)+
  labs(x="Proporção de número de enfermeiro(s)", y="Frequência") +
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=10),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))

#### Boxplot
graf102 <- (ggplot(dados,aes(x=factor(""), y=X10))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de número de enfermeiro(s)")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf101, graf102,ncol=2)

#### Gráfico de probabilidade normal
ggplot(dados, aes(sample = X10)) +
  stat_qq(colour = "darkslategray") +
  labs(x="",y="Número de enfermeiro(s)")+
  stat_qq_line()+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=10),
         axis.title.x=element_text(colour="black",size=12),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black"))

#### Teste de normalidade - Shapiro Wilk

shapiro.test(dados$X10)

### Variável X11 - Facilidades e serviços disponíveis

#### Tabela de medidas

meanX11 = mean(dados$X11)
medianX11= median(dados$X11)
q1X11 = quantile(dados$X11, names=FALSE)[2]
q2X11 = quantile(dados$X11, names=FALSE)[3]
q3X11 = quantile(dados$X11, names=FALSE)[4]
q4X11 = quantile(dados$X11, names=FALSE)[5]
maxX11 = max(dados$X11)
minX11 = min(dados$X11)

varX11 = var(dados$X11)
sdX11 = sd(dados$X11)

d1X11 = quantile(dados$X11, seq(0, 1, 0.1), names=FALSE)[2]
d9X11 = quantile(dados$X11, seq(0, 1, 0.1), names=FALSE)[10]

skewX11 = 3*(meanX11 - medianX11)/sdX11
kurtX11 = (q3X11 - q1X11)/(2*(d9X11 - d1X11))
coef.varX11 = (sdX11/meanX11)*100

mX11 <- c(round(c(meanX11,minX11,q1X11,medianX11,q3X11,maxX11,
                  varX11,sdX11,skewX11,kurtX11,coef.varX11),2))
nX11 <- c("Média","Mínimo","1º Quartil","Mediana","3º Quartil","Máximo",
          "Variância","Desvio Padrão","Assimetria","Curtose",
          "Coeficiente de Variação(%)")
variX11 <- data.frame(Medidas = nX11, Valores = mX11)
kable(variX11,caption = "Medidas de posição, variabilidade, 
      assimetria e curtose")

#### Tabela de frequência

freq_salarios <- table(cut(dados$X11,breaks = seq(5,85,10)))
kable(freq_salarios,col.names = c("Proporção de facilidades e serviços 
                                  disponíveis","Frequência"),
      caption = "Distribuição de frequência para facilidades 
      e serviços disponíveis")

#### Histograma

graf111 <- (ggplot(dados,aes(x=X11))+
              geom_histogram(colour="white",fill="darkslategray",
                             binwidth=10)+
  labs(x="Proporção de facilidades e serviços disponíveis", y="Frequência")+
  theme_bw ()+
  theme(axis.title.y=element_text(colour="black",size=10),
        axis.title.x=element_text(colour="black",size=9),
        axis.text=element_text(colour="black",size=9.5) ,
        panel.border=element_blank(),
        axis.line=element_line(colour="black"),
        plot.title = element_text(size=10,hjust=0.3,colour="black")))


#### Boxplot
graf112 <- (ggplot(dados,aes(x=factor(""), y=X11))+
  geom_boxplot(fill=c("darkslategray"),width=0.5)+
  stat_summary(fun.y="mean",geom="point",shape=23,size=3,fill="white")+
  labs(x="",y="Proporção de facilidades e serviços disponíveis")+
  theme_bw()+
  theme (axis.title.y=element_text(colour="black",size=9),
         axis.title.x=element_text(colour="black",size=10),
         axis.text=element_text(colour="black",size=9.5),
         panel.border=element_blank(),
         axis.line.y=element_line(colour="black"),
         plot.title = element_text(size=10,hjust=0.3,colour="black")))

grid.arrange(graf111, graf112,ncol=2)

## Bivariada

### Modelo 1

#### Região x Enfermeiros

##### Boxplot
ggplot(dados, aes(x = X8, group = X8, y = X10))+
  geom_boxplot(fill = c("#69d171","#d96464","#99aae8","#d09ff5"))+
  theme_minimal()+
  xlab("Região")+
  ylab("Número de Enfermeiros")

##### Tabela de Frequência

x <- dados %>%
  group_by(X8) %>%
  summarise("Freq. Observada" = sum(X10)) %>%
  mutate("Freq. Esperada" = sum(dados$X10)*0.25) %>%
  mutate(Região = fct_recode(X8, "NE" = "1", "NC" = "2",
                                             "S" = "3", "W" = "4"))

x <- data.frame(x$Região, x$`Freq. Observada`, x$`Freq. Esperada`)
names(x) <- c("Região", "Freq. Observada", "Freq. Esperada")

kable(x, caption = "Tabela de Freq. do Número de Enfermeiros por Região")

#### Facilidades e Serviços x Enfermeiros

##### Gráfico de Dispersão

ggplot(dados, aes(X11, X10))+
  geom_point(color = "darkslategray")+
  geom_smooth(se = F, color = "black")+
  theme_minimal()+
  xlab("Facilidades e Serviços disponíveis (%)")+
  ylab("Número de Enfermeiros")

##### Tabela

x <- data.frame(round(cor(dados$X11, dados$X10, 
                          method = "spearman"), 3),
                round(cor(amostra1$X11, amostra1$X10,
                          method = "spearman"), 3),
                round(cor(amostra2$X11, amostra2$X10, 
                          method = "spearman"), 3))
names(x) <- c("Dados Completos", "Amostra 1", "Amostra 2")

kable(x)

```

```{r eval=F}
### Modelo 2

#### Relação entre Duração da Internação e Idade

##### Gráfico de Dispersão

ggplot(dados, aes(X2,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Idade(X2)")


##### Tabela

knitr::kable(cbind(round(cor(dados$X2,dados$X1), 3),
                   round(cor(amostra1$X2,amostra1$X1), 3),
                   round(cor(amostra2$X2,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = 
               c("Dados Completos", "Amostra 1", "Amostra 2"))

#### Relação entre Duração da Internação e Risco de Infecção

##### Gráfico de Dispersão

ggplot(dados, aes(X3,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Risco de infecção(X3)")


##### Tabela

knitr::kable(cbind(round(cor(dados$X3,dados$X1), 3),
                   round(cor(amostra1$X3,amostra1$X1), 3),
                   round(cor(amostra2$X3,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = 
               c("Dados Completos", "Amostra 1", "Amostra 2"))

#### Relação entre Duração da Internação e Número de leitos

##### Gráfico de Dispersão

ggplot(dados, aes(X6,X1))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Número de leitos(X6)")


##### Tabela

knitr::kable(cbind(round(cor(dados$X6,dados$X1), 3),
                   round(cor(amostra1$X6,amostra1$X1), 3),
                   round(cor(amostra2$X6,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", col.names = 
               c("Dados Completos", "Amostra 1", "Amostra 2"))

#### Relação entre Duração da Internação e Filiação a Escola de Medicina

##### Boxplot

ggplot(dados, aes(X7,X1))+
  geom_boxplot(fill = c("#69d171","#d96464"))+
  theme_minimal()+
  labs(y = "Duração da internação(X1)", 
       x = "Filiação a Escola de Medicina(X7)")+
  scale_x_discrete(labels=c("1" = "Sim", "2" = "Não"))


##### Histograma

ggplot(dados, aes(X1))+
  geom_histogram(aes(), color = "black", fill = "darkslategrey")+
  theme_minimal()+
  facet_wrap(~X7, labeller = as_labeller(c("1" = "Sim", "2" = "Não")))+
  theme(strip.background =element_rect(fill="skyblue"))+
  labs( x = "Duração da internação(X1)", y = "Contagem",
        title = "Distribuição dos dias de internação por filiação")

###### Transformação dos dados

x1 <- amostra1 %>%
  group_by(X7) %>%
  summarise("Freq. absoluta amostra1" = n(),
            "Freq. relativa amostra1" = n()/57) %>%
  mutate(`Filiação amostra1`  = fct_recode(X7,
                                           "Sim" = "1",
                                           "Não" = "2")) %>% 
  select(4,2,3)

x2 <- amostra2 %>%
  group_by(X7) %>%
  summarise("Freq. absoluta amostra2" = n(),
            "Freq. relativa amostra2" = n()/56) %>%
  mutate(`Filiação amostra2`  = fct_recode(X7,
                                           "Sim" = "1",
                                           "Não" = "2")) %>% 
  select(4,2,3)

x3 <- dados %>%
  group_by(X7) %>%
  summarise("Freq. absoluta dados" = n(),
            "Freq. relativa dados" = n()/113) %>%
  mutate(`Filiação dados` = fct_recode(X7,
                                       "Sim" = "1",
                                       "Não" = "2")) %>% 
  select(4,2,3)


x <- list(x1,x2,x3)

##### Tabela 

knitr::kable(x, caption = "Tabela da Freq. dos dias de 
             internação por filiação")

#### Relação entre Duração da Internação e Região

##### Boxplot

ggplot(dados, aes(X8,X1))+
  geom_boxplot(fill = c("#69d171","#d96464","#99aae8","#d09ff5"))+
  theme_minimal()+
  labs(y = "Duração da internação(X1)", x = "Região(X8)")+
  scale_x_discrete(labels=c("1" = "NE", "2"= "NC", "3" = "S",  
                            "4" = "W"))


##### Histograma

ggplot(dados, aes(X1))+
  geom_histogram(aes(), color = "black", fill = "darkslategrey")+
  theme_minimal()+
  facet_wrap(~X8, labeller = as_labeller(c("1" = "NE", "2"= "NC", 
                                           "3" = "S", 
                                           "4" = "W")))+
  theme(strip.background =element_rect(fill="skyblue"))+
  labs( x = "Duração da internação(X1)", y = "Contagem",
        title = "Distribuição dos dias de internação por região")

###### Transformação dos dados

x11 <- amostra1 %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/57) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,  
                              "W" ="4")) %>% 
  select(4,2,3)

x22 <- amostra2 %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/56) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,  
                              "W" ="4")) %>% 
  select(4,2,3)


x33 <- dados %>%
  group_by(X8) %>%
  summarise("Freq. absoluta" = n(),"Freq. relativa" = n()/113) %>%
  mutate(Região  = fct_recode(X8,
                              "NE" ="1",  "NC" ="2",  "S" ="3" ,   
                              "W" ="4")) %>% 
  select(4,2,3)

##### Tabela 

knitr::kable(list(x11,x22,x33), 
             caption = "Tabela da Freq. dos dias de internação 
             por região")

#### Relação entre Duração da Internação e Média diária de pacientes

##### Gráfico de Dispersão

ggplot(dados, aes(X9,X1))+
  geom_point(color = "darkslategrey")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", 
       x = "Média diária de pacientes(X9)")

##### Tabela
knitr::kable(cbind(round(cor(dados$X9,dados$X1), 3),
                   round(cor(amostra1$X9,amostra1$X1), 3),
                   round(cor(amostra2$X9,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson",
             col.names = c("Dados Completos", "Amostra 1",
                           "Amostra 2"))

#### Relação entre Duração da Internação e Número de enfermeiro(s)

##### Gráfico de Dispersão

ggplot(dados, aes(X10,X1))+
  geom_point(color = "darkslategrey")+
  theme_minimal()+
  geom_smooth(method = "lm", se = F, color = "black")+
  labs(y = "Duração da internação(X1)", x = "Número de infermeiros(X10)")

##### Tabela
knitr::kable(cbind(round(cor(dados$X10,dados$X1), 3),
                   round(cor(amostra1$X10,amostra1$X1), 3),
                   round(cor(amostra2$X10,amostra2$X1), 3)),
             caption = "Correlação linear de Pearson", 
             col.names = c("Dados Completos", "Amostra 1", "Amostra 2"))


# Modelo 1
## Modelo Completo

xi1 <- banco.modelo1$X1 - mean(banco.modelo1$X1)

modelo1.completo <- lm(banco.modelo1$Y~xi1 + 
                         I(xi1^2)+banco.modelo1$X21+
                         banco.modelo1$X22+ banco.modelo1$X23)

#summary(modelo1.completo)

### Tabelas
#### Tabela 1
nomes <- c("Intercepto","$x_{i1}$","$x_{i1}^2$","$X_{21}$",
           "$X_{22}$","$X_{23}$")

kable(cbind(nomes,summary(modelo1.completo)[["coefficients"]]),
      col.names = c("Variáveis","Estimativas",
                    "Erro Padrão","Estatística","P-valor"),
      row.names = FALSE)

#### Tabela 2
df <- data.frame(F = 45.64,
                 glnum = 5,
                 gldem = 51,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador",
                        "Graus de Liberdade Denominador","P-valor"))

#### Tabela 3
kable(data.frame("1" = c(70.14),
                 "2" = c(51)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))

#### Tabela 4

kable(cbind(0.8174, 0.7994), col.names = c("$R^2$", "$R^2_{ajustado}$"))

### Gráficos Análise de Resíduos

a <- ggplot(modelo1.completo, 
            aes(modelo1.completo$fitted.values,
                modelo1.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo1, aes(X1,modelo1.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")

c <- ggplot(banco.modelo1, aes(sample = modelo1.completo$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()


grid.arrange(a,b,c,nrow=2,ncol=2)

### Teste e tabela verificação de normalidade e variância constante

s <- shapiro.test(modelo1.completo$residuals)
bp <- bptest(lm(banco.modelo1$Y~xi1 + I(xi1^2)+banco.modelo1$X21+
                  banco.modelo1$X22+ banco.modelo1$X23))
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))

## Modelo Transformado 

modelo1.trans <- lm(log(banco.modelo1$Y)~xi1 + 
                      I(xi1^2)+banco.modelo1$X21+ 
                      banco.modelo1$X22+ banco.modelo1$X23)

#summary(modelo1.trans)

### Tabelas 

#### Tabela 1
nomes <- c("Intercepto","$x_{i1}$","$x_{i1}^2$","$X_{21}$",
           "$X_{22}$","$X_{23}$")

kable(cbind(nomes,summary(modelo1.trans)[["coefficients"]]),
      col.names = c("Variáveis","Estimativas",
                    "Erro Padrão","Estatística","P-valor"),
      row.names = FALSE)

#### Tabela 2
df <- data.frame(F = 45.03,
                 glnum = 5,
                 gldem = 51,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador",
                        "Graus de Liberdade Denominador","P-valor"))

#### Tabela 3

kable(data.frame("1" = c(0.4094),
                 "2" = c(51)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))

#### Tabela 4

kable(cbind(0.8153, 0.7972), col.names = c("$R^2$", "$R^2_{ajustado}$"))

### Gráficos Análise de Resíduos

a <- ggplot(modelo1.trans, aes(modelo1.trans$fitted.values,
                               modelo1.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo1, aes(X1,modelo1.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")

c <- ggplot(banco.modelo1, aes(sample = modelo1.trans$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()


grid.arrange(a,b,c,nrow=2,ncol=2)

### Teste e tabela verificação de normalidade e variância constante

s <- shapiro.test(modelo1.trans$residuals)
bp <- bptest(lm(log(banco.modelo1$Y)~xi1 + 
                  I(xi1^2)+banco.modelo1$X21+ banco.modelo1$X22+
                  banco.modelo1$X23))
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))

### Modelo Eliminação backward manual

modelo1.tbm <- lm(log(Y)~X1, data=banco.modelo1)

### Gráficos Critério de Seleção

selecao <- regsubsets(log(Y) ~ ., data = banco.modelo1, nbest = 5)

num.var <- as.numeric(rownames(summary(selecao)$which))

df <- data.frame(num.var, r2 = summary(selecao)$rsq, 
                 r2adj = summary(selecao)$adjr2, bic = summary(selecao)$bic,
                 cm = summary(selecao)$cp)

a <- ggplot(df, aes(x=num.var, y=bic)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="BIC") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

b <- ggplot(df, aes(x=num.var, y=cm)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="CM") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)


c <- ggplot(df, aes(x=num.var, y=r2)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R²") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

d <- ggplot(df, aes(x=num.var, y= r2adj)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R² ajustado") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

grid.arrange(a,b,c,d,ncol=2)

### Modelos Critério de Seleção

#### 1 Variável
modelo11 <- lm(log(Y)~X1,data = banco.modelo1)
#summary(modelo11)

#### 2 Variáveis
modelo12 <- lm(log(banco.modelo1$Y)~banco.modelo1$X1 + banco.modelo1$X22)
#summary(modelo12)

#### Tabela de comparação

mod11 <-  c( 0.8116140357,	0.80463678,	-83.018804,	1.65778088)
mod12 <-  c(	0.8103392395,	0.80689086,	-86.677439,	0.01411284)
df <- rbind(mod11,mod12)
kable(df, col.names = c("$R^2$","$R^2_{Ajustado}$","BIC","CM" ))

## Modelo escolhido

### Gráfico Análise de Resíduos

a <- ggplot(modelo11, aes(modelo11$fitted.values,modelo11$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo1, aes(X1,modelo11$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Facilidades e serviços disponíveis")+
  ylab("Resíduos")


c <- ggplot(banco.modelo1, aes(sample = modelo11$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,ncol=2)

### Teste e tabela verificação de normalidade e variância constante

s <- shapiro.test(modelo11$residuals)
bp <- bptest(lm(log(banco.modelo1$Y)~banco.modelo1$X1))


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"), 
      row.names = F)

### Gráfico medidas influentes

medidas <- as.data.frame(influence.measures(modelo11)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X1)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - xi1")
 

 
grid.arrange(a, b, c, ncol = 2)
#banco.modelo22 <- banco.modelo1[-48,]
#summary(lm(log(banco.modelo22$Y) ~ xi1[-48]))
#banco.modelo22 <- banco.modelo1[-49,]
#summary(lm(log(banco.modelo22$Y) ~ xi1[-49]))

### Validação do modelo escolhido 

num.enf.chapeu <- predict(modelo11, banco.validacao1)
MSPR <- mean((log(banco.validacao1[,1]) - num.enf.chapeu)^2)
kable(cbind(anova(modelo11)["Residuals","Mean Sq"],MSPR),
      col.names = c("MSE", "MSPR"))

### Estimação e Tabela Parâmetros

betas <- c("Beta_0","Beta_1")
kable(cbind(betas,summary(modelo11)[["coefficients"]]) ,
      col.names = c("Parâmetros","Estimativas",
                    "Erro Padrão","Estatística","P-valor"), row.names = F)

# Modelo 2

## Modelo com todas as variáveis

banco.mod <- amostra1

banco.mod$X7 <- as.character(banco.mod$X7)

a <- banco.mod$X7
a <- as.character(a)
a[-c(which(a == "Sim"))] = 0
a[c(which(a == "Sim"))] = 1

banco.mod$X61 <- as.factor(a) 


a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "NE"))] = 0
a[c(which(a == "NE"))] = 1

banco.mod$X71 <- as.factor(a)    

a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "NC"))] = 0
a[c(which(a == "NC"))] = 1

banco.mod$X72 <- as.factor(a)    

a <- banco.mod$X8
a <- as.character(a)
a[-c(which(a == "S"))] = 0
a[c(which(a == "S"))] = 1
banco.mod$X73 <- as.factor(a) 

banco.mod <- banco.mod[,c(-1,-8,-9)]

mod <- lm(X1~X2+X3+X4+X5+X6+X9+X10+X11+X61+X71+X72+X73, data = banco.mod)

### Gráficos análise de resíduo

a <- ggplot(mod, aes(mod$fitted.values,mod$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")

b <- ggplot(banco.mod, aes(sample = mod$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,ncol=2)

### Teste e tabela verificação de normalidade e variância constante

s <- shapiro.test(mod$residuals)
bp <- bptest(mod)

teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(4.8763,0.98845)
 
pv <- c(0.962,0.8618)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))

kable(summary(mod)[["coefficients"]],
      col.names = c("Estimativas","Erro Padrão","Estatística","P-valor"))

## Modelo Completo

modelo2.completo <- lm(Y~X1+X2+X3+X4+X5+X61+X71+X72+X73,data=banco.modelo2)

### Tabelas 

#### Tabela 1
df <- data.frame("Variável" = c("Intercepto", "X1", "X2", "X3", "X4",
                                "X5", "X61", "X71", "X72", "X73"),
                 "Estimativas"= c(3.307, 0.0609, 0.4092, -0.0088, 0.0214,
                                  -0.0073, 0.3179, 1.4706, 0.7521, 0.2579),
                 "Erro Padrão"=c(2.0034,0.0348,0.1170,0.0046,
                                 0.0053,0.0027,0.5809,0.5042,0.4767,0.4704),
                 "Estatística" = c(1.663,1.751,3.497,-1.894,
                                   4.020,-2.674,0.547,2.917,1.578,0.548),
                 "P-valor" = c(0.1031,0.0865,0.0010,0.0644,0.0002,
                               0.0103,0.5868,0.0054,0.1213,0.5861))
names(df) <- c("Variável","Estimativas","Erro Padrão",
               "Estatística","P-valor")
kable(df)

#### Tabela 2
df <- data.frame(F = 14.16,
                 glnum = 9,
                 gldem = 47,
                 pvalor = "<0.0001")
kable(df, col.names = c("Estatística F", "Graus de Liberdade Numerador",
                        "Graus de Liberdade Denominador","P-valor"))

#### Tabela 3

kable(data.frame("1" = c(1.087),
                 "2" = c(47)),
      col.names = c("Erro padrão do resíduo", "Graus de Liberdade"))

#### Tabela 4

kable(cbind(0.7306, 0.679), col.names = c("$R^2$", "$R^2_{ajustado}$"))

### Gráficos Análise de Resíduos

a <- ggplot(modelo2.completo, aes(modelo2.completo$fitted.values,
                                  modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")


b <- ggplot(banco.modelo2, aes(X1,modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Idade")+
  ylab("Resíduos")

c <- ggplot(banco.modelo2, aes(X2,modelo2.completo$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")


d <- ggplot(banco.modelo2, aes(X3,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número de leitos")+
ylab("Resíduos")


e <- ggplot(banco.modelo2, aes(X4,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
f <- ggplot(banco.modelo2, aes(X5,modelo2.completo$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

grid.arrange(a,b,c,d,e,f,ncol=3)

### Gráfico de probabilidade normal

ggplot(banco.modelo2, aes(sample = modelo2.completo$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

### Tabela dos testes

s <- shapiro.test(modelo2.completo$residuals)
bp <- bptest(Y~X1+X2+X3+X4+X5+X61+X71+X72+X73,data=banco.modelo2)
 
teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(4.8412,0.99143)
 
pv <- c(0.8479,0.9581)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"))

### Seleção de variáveis

#### Modelo Eliminação backward manual
modelo2.reduzido <- lm(Y~X2+X3+X4+X5+X71,data=banco.modelo2)

#### Critério de Seleção

##### Gráficos

selecao <- regsubsets(Y ~ ., data = banco.modelo2, nbest = 8)

num.var <- as.numeric(rownames(summary(selecao)$which))

df <- data.frame(num.var, r2 = summary(selecao)$rsq, 
                 r2adj = summary(selecao)$adjr2, bic = summary(selecao)$bic, 
                 cm = summary(selecao)$cp)

a <- ggplot(df, aes(x=num.var, y=bic)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="BIC") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

b <- ggplot(df, aes(x=num.var, y=cm)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="CM") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)


c <- ggplot(df, aes(x=num.var, y=r2)) + 
  geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R²") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

d <- ggplot(df, aes(x=num.var, y= r2adj)) 
+ geom_point(colour="darkslategray", size=2, alpha = 0.65) +
labs(x="Número de variáveis explicativas", y="R² ajustado") +
theme_bw() +
theme(axis.title.y=element_text(colour="black", size=10),
axis.title.x = element_text(colour="black", size=10),
axis.text = element_text(colour = "black", size=9.5),
panel.border = element_blank(),
axis.line = element_line(colour = "black")) +
scale_x_continuous(breaks = 1:8)

grid.arrange(a,b,c,d,ncol=2)

#### Modelo 4 variáveis

modelo24 <- lm(Y~X2+X4+X5+X71,data=banco.modelo2)
#summary(modelo24)

#### Modelo 5 variáveis

modelo25 <- lm(Y~X2+X3+X4+X5+X71,data=banco.modelo2)
#summary(modelo25)

#### Modelo 6 variáveis

modelo26 <- lm(Y~X1+X2+X3+X4+X5+X71,data=banco.modelo2)
#summary(modelo26)

#### Tabela comparação dos modelos

mod1 <-  c(4, 0.6660346,	0.6403450,	-42.29767,	11.27045)
mod2 <-  c(5,	0.6949882,	0.6650851,	-43.42376,	8.218618)
mod3 <-  c(6,	0.7096083,	0.6747613,	-42.18055,	7.667686)
df <- rbind(mod1,mod2,mod3)
kable(df, col.names = c("Modelo","$R^2$","$R^2_{Ajustado}$","BIC","CM" ))
```

```{r eval=F}
## Modelo Final 2

### Gráfico Análise de Resíduo

a <- ggplot(modelo24, aes(modelo24$fitted.values,modelo24$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo2, aes(X2,modelo24$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")



c <- ggplot(banco.modelo2, aes(X4,modelo24$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
d <- ggplot(banco.modelo2, aes(X5,modelo24$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

e <- ggplot(banco.modelo2, aes(sample = modelo24$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,d,e,ncol=3)

### Testes e Tabela Análise de Resíduos

s <- shapiro.test(modelo24$residuals)
bp <- bptest(Y~X2+X4+X5+X71,data=banco.modelo2)


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", 
                            "P-valor"), row.names = F)

### Multicolinearidade

vi<-vif(modelo24)
kable(vi, col.names = "VIF")

### Medidas influentes

medidas <- as.data.frame(influence.measures(modelo24)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X2)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Risco de Infecção")
 
d <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X4)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Média Diária de Pacientes")
 
e <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X5)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Número de Enfermeiros")
 
f <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X711)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Região NE")
 
grid.arrange(a, b, c, d, e, f, ncol = 3)

#summary(lm(Y ~ X2+X4+X5+X71, data = banco.modelo2))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-56,]))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-28,]))

### Validação Modelo Final 2

num.enf.chapeu <- predict(modelo24, banco.validacao2)
MSPR <- mean((banco.validacao2[,1] - num.enf.chapeu)^2)
kable(cbind(anova(modelo24)["Residuals","Mean Sq"],MSPR),
      col.names = c("MSE", "MSPR"))


## Modelo Final Transformado para a questão 2

modelo24.trans <- lm(log(Y)~X2+X4+X5+X71,data=banco.modelo2)

### Gráfico Análise de Resíduos

a <- ggplot(modelo24.trans, aes(modelo24.trans$fitted.values,modelo24.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Valores Ajustados")+
  ylab("Resíduos")



b <- ggplot(banco.modelo2, aes(X2,modelo24.trans$residuals))+
  geom_point(color = "darkslategray")+
  theme_minimal()+
  xlab("Risco de Infecção")+
  ylab("Resíduos")



c <- ggplot(banco.modelo2, aes(X4,modelo24.trans$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número Médio de pacientes")+
ylab("Resíduos")
 
d <- ggplot(banco.modelo2, aes(X5,modelo24.trans$residuals))+
geom_point(color = "darkslategray")+
theme_minimal()+
xlab("Número médio de infermeiros(as)")+
ylab("Resíduos")

e <- ggplot(banco.modelo2, aes(sample = modelo24.trans$residuals)) +
  stat_qq(colour = "darkslategray") +
  labs(x="Quantis teóricos",y="Quantis dos Resíduos")+
  stat_qq_line()+
  theme_bw()

grid.arrange(a,b,c,d,e,ncol=3)

### Testes e Tabela Análise de Resíduos

s <- shapiro.test(modelo24.trans$residuals)
bp <- bptest(log(Y)~X2+X4+X5+X71,data=banco.modelo2)


teste <- c("Breusch-Pagan","Shapiro-Wilk")
 
est <- c(bp$statistic,s$statistic)
 
pv <- c(bp$p.value,s$p.value)
 
tabela <- data.frame(teste, est,pv)
 
kable(tabela, col.names = c("Teste", "Estatísca do Teste", "P-valor"),
      row.names = F)

### Multicolinearidade

vi<-vif(modelo24.trans)
kable(vi, col.names = "VIF")

### Medidas influentes

medidas <- as.data.frame(influence.measures(modelo24.trans)[[1]])
 

a <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dffit)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFFIT")
 
b <- ggplot(medidas, aes(x = c(1:57), y = medidas$cook.d))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("Distância de Cook")
 
c <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X2)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Risco de Infecção")
 
d <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X4)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Média Diária de Pacientes")
 
e <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X5)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Número de Enfermeiros")
 
f <- ggplot(medidas, aes(x = c(1:57), y = abs(medidas$dfb.X711)))+
      geom_point(color = "darkslategrey")+
      theme_minimal()+
      xlab("Índice")+
      ylab("DFBETA - Região NE")
 
grid.arrange(a, b, c, d, e, f, ncol = 3)

#summary(lm(Y ~ X2+X4+X5+X71, data = banco.modelo2))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-56,]))
#summary(lm(Y ~ X2+X4+X5+X71, data =banco.modelo2[-28,]))

### Validação do Modelo Final 2 Transformado

num.enf.chapeu <- predict(modelo24.trans, banco.validacao2)
MSPR <- mean((log(banco.validacao2[,1]) - num.enf.chapeu)^2)
kable(cbind(anova(modelo24.trans)["Residuals","Mean Sq"],MSPR),
      col.names = c("MSE", "MSPR"))

### Estimação e Tabela Parâmetros

betas <- c("Beta_0","Beta_2","Beta_4","Beta_5","Beta_71")
kable(cbind(betas,summary(modelo24.trans)[["coefficients"]]) ,
      col.names = c("Parâmetros","Estimativas",
                    "Erro Padrão","Estatística","P-valor"), 
      row.names = F)
```


\newpage

# Referências Bibliográficas